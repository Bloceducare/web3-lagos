(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4527],{9484:(e,t,n)=>{"use strict";n.d(t,{LG:()=>m,H3:()=>h,T2:()=>g});var a=n(52105),i=n(5862),s=n(78511),r=n(38928),l=n(7094);let o=(0,i._)({get:{params:l.z.object({id:r.k.objectIdString()}),data:s.cA.nullish()},delete:{params:l.z.object({id:r.k.objectIdString()}),data:l.z.object({ok:l.z.boolean()})},patch:{params:l.z.object({id:r.k.objectIdString()}),query:l.z.object({updateAgents:l.z.string().optional()}),body:s.cA.omit({_id:!0,threatEvaluation:!0}).partial(),data:s.cA.nullish()}});var d=n(98354),c=n(94344),u=n(94559),p=n(79879);let m=(0,a.In)("GET","/api/agentTemplateDefinition/:id",o.get.data);function h(e){return["agentTemplateDefinition/[id]","get",e.params.id]}function g(e){let t=(0,c.useMemo)(()=>["agentTemplateDefinition/[id]","get",e.params.id],[e.params.id]),n=(0,u.lB)(()=>null==e?void 0:e.options,[null==e?void 0:e.options]),a=(0,d.I)({queryKey:t,queryFn:async()=>{let{data:t,error:n}=await m(e);if(n)throw n;return t},...null==e?void 0:e.options}),i=(0,u.lB)(()=>a,[a]);return(0,p.R)(t,i,n)}},96536:(e,t,n)=>{"use strict";n.d(t,{N:()=>l});var a=n(52105),i=n(5862),s=n(7094);let r=(0,i._)({post:{query:s.z.object({filename:s.z.string()}),body:s.z.unknown(),data:s.z.object({attachmentId:s.z.string().nullish(),failureReason:s.z.string().nullish()})}}),l=(0,a.In)("POST","/api/conversations/files/upload",r.post.data)},20259:(e,t,n)=>{"use strict";n.d(t,{q:()=>o});var a=n(52105),i=n(5862),s=n(38928),r=n(7094);let l=(0,i._)({post:{params:r.z.object({id:s.k.objectIdString()}),data:r.z.object({ok:r.z.boolean()})}}),o=(0,a.In)("POST","/api/conversations/:id/stopExecution",l.post.data)},83026:(e,t,n)=>{"use strict";n.d(t,{LW:()=>eQ});var a=n(50612);let i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ConversationViewQueryFragment",selections:[{alias:null,args:null,concreteType:"Identity",kind:"LinkedField",name:"me",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"PromptInputQueryFragment"},{args:null,kind:"FragmentSpread",name:"SubscriptionContext_Identity"},{args:null,kind:"FragmentSpread",name:"Transcript_Identity"}],storageKey:null}],type:"Query",abstractKey:null};i.hash="4a7e463d0160a4546543dfe06536cf91";let s={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ConversationView_AgentDefinition",selections:[{args:null,kind:"FragmentSpread",name:"Transcript_AgentDefinition"}],type:"AgentDefinition",abstractKey:null};s.hash="ab8bb9fc34e7b111f55f9fda7d5bf186";var r=n(88620),l=n(52105),o=n(5862),d=n(38928),c=n(7094);let u=(0,o._)({put:{params:c.z.object({id:d.k.objectIdString()}),data:c.z.object({ok:c.z.boolean()})}}),p=(0,l.In)("PUT","/api/conversations/:id/isSeen",u.put.data);var m=n(6925),h=n(38001),g=n(46772),v=n(98906),f=n(10293),x=n(78233),y=n(34698),_=n(27273),b=n(72352),k=n(36175),w=n(25270),C=n(47893),S=n(94344),j=n(77576),I=n(51068),T=n(55663),E=n(2932),N=n(60003),A=n(38102),P=n(69507),F=n(31024),R=n(45801),z=n(31284),M=n(89073),D=n(77566),L=n(35774),O=n(8678),V=n(79124),K=n(25919),Q=n(41324),B=n(98523),H=n(86893),U=n(42598),q=n(40223);let W=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"nodeId"}],t=[{kind:"Variable",name:"id",variableName:"nodeId"}],n={alias:null,args:null,kind:"ScalarField",name:"creditAllocation",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"PromptInputRefetchQuery",selections:[{alias:null,args:t,concreteType:null,kind:"LinkedField",name:"node",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"PromptInputQueryFragment"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"PromptInputRefetchQuery",selections:[{alias:null,args:t,concreteType:null,kind:"LinkedField",name:"node",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"nodeId",storageKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"SubscriptionInfo",kind:"LinkedField",name:"billingInfo",plural:!1,selections:[{alias:null,args:null,concreteType:"CreditsInfo",kind:"LinkedField",name:"creditsInfo",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"creditBalance",storageKey:null},n],storageKey:null},{alias:null,args:null,concreteType:"PaymentFailure",kind:"LinkedField",name:"lastPaymentFailure",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"date",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"TrialInfo",kind:"LinkedField",name:"trialInfo",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"expiresAt",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"SubscriptionFeatures",kind:"LinkedField",name:"features",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"isEligibleForFreePlan",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"SubscriptionPlan",kind:"LinkedField",name:"subscriptionPlan",plural:!1,selections:[n],storageKey:null},{alias:null,args:null,concreteType:"UpcomingPlan",kind:"LinkedField",name:"upcomingPlan",plural:!1,selections:[{alias:null,args:null,concreteType:"SubscriptionPlan",kind:"LinkedField",name:"subscriptionPlan",plural:!1,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"planType",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"startDate",storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isMedicalScribe",storageKey:null}],type:"Identity",abstractKey:null}],storageKey:null}]},params:{cacheID:"a7eaec94c72da3c551d149eca7affd46",id:null,metadata:{},name:"PromptInputRefetchQuery",operationKind:"query",text:"query PromptInputRefetchQuery(\n  $nodeId: ID!\n) {\n  node(id: $nodeId) {\n    __typename\n    ...PromptInputQueryFragment\n    nodeId\n  }\n}\n\nfragment PlansModal_Identity on Identity {\n  nodeId\n  isMedicalScribe\n  billingInfo {\n    trialInfo {\n      expiresAt\n    }\n    features {\n      isEligibleForFreePlan\n    }\n  }\n  ...ProPlanMe\n  ...ProPlanMedicalMe\n  ...UpcomingPlanMe\n}\n\nfragment ProPlanMe on Identity {\n  billingInfo {\n    subscriptionPlan {\n      creditAllocation\n    }\n    upcomingPlan {\n      subscriptionPlan {\n        creditAllocation\n        planType\n      }\n    }\n  }\n}\n\nfragment ProPlanMedicalMe on Identity {\n  billingInfo {\n    creditsInfo {\n      creditAllocation\n    }\n    upcomingPlan {\n      subscriptionPlan {\n        planType\n      }\n    }\n  }\n}\n\nfragment PromptInputQueryFragment on Identity {\n  nodeId\n  billingInfo {\n    creditsInfo {\n      creditBalance\n    }\n    lastPaymentFailure {\n      date\n    }\n  }\n  ...PlansModal_Identity\n}\n\nfragment UpcomingPlanMe on Identity {\n  isMedicalScribe\n  billingInfo {\n    trialInfo {\n      expiresAt\n    }\n    subscriptionPlan {\n      creditAllocation\n    }\n    upcomingPlan {\n      subscriptionPlan {\n        creditAllocation\n        name\n        planType\n      }\n      startDate\n    }\n  }\n}\n"}}}();W.hash="2003b37c1eb2dad01b555acddb0e7711";let Y={argumentDefinitions:[],kind:"Fragment",metadata:{refetch:{connection:null,fragmentPathInResult:["node"],operation:W,identifierInfo:{identifierField:"nodeId",identifierQueryVariableName:"id"}}},name:"PromptInputQueryFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"nodeId",storageKey:null},{alias:null,args:null,concreteType:"SubscriptionInfo",kind:"LinkedField",name:"billingInfo",plural:!1,selections:[{alias:null,args:null,concreteType:"CreditsInfo",kind:"LinkedField",name:"creditsInfo",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"creditBalance",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"PaymentFailure",kind:"LinkedField",name:"lastPaymentFailure",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"date",storageKey:null}],storageKey:null}],storageKey:null},{args:null,kind:"FragmentSpread",name:"PlansModal_Identity"}],type:"Identity",abstractKey:null};Y.hash="2003b37c1eb2dad01b555acddb0e7711",n(39594);var Z=n(31722),$=n(97746),J=n(20259),X=n(12454),G=n(30900),ee=n(88036),et=n(6762),en=n(47830),ea=n(31173),ei=n(1656),es=n(25363),er=n(27631),el=n(25347);let eo=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"id"}],t=[{kind:"Variable",name:"id",variableName:"id"}],n={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"hasPremiumActions",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"hasPremiumTriggers",storageKey:null}],type:"AgentDefinition",abstractKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"useHasPremiumFeaturesQuery",selections:[{alias:null,args:t,concreteType:null,kind:"LinkedField",name:"node",plural:!1,selections:[n],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"useHasPremiumFeaturesQuery",selections:[{alias:null,args:t,concreteType:null,kind:"LinkedField",name:"node",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},n,{alias:null,args:null,kind:"ScalarField",name:"nodeId",storageKey:null}],storageKey:null}]},params:{cacheID:"2581c65213f23dd574bd14a9f2bf1999",id:null,metadata:{},name:"useHasPremiumFeaturesQuery",operationKind:"query",text:"query useHasPremiumFeaturesQuery(\n  $id: ID!\n) {\n  node(id: $id) {\n    __typename\n    ... on AgentDefinition {\n      hasPremiumActions\n      hasPremiumTriggers\n    }\n    nodeId\n  }\n}\n"}}}();eo.hash="fb891beae60b0c064923e2663345340e";var ed=n(20923),ec=n(98354),eu=n(97244),ep=n(90819),em=n(47376),eh=n(84075),eg=n(82813),ev=n(16939),ef=n(81211),ex=n(35686),ey=n(47489),e_=n(99968),eb=n(40252),ek=n(66679),ew=n(40453),eC=n(682),eS=n(14306),ej=n(67434),eI=n(16008),eT=n(81778),eE=n(18153),eN=n(51847),eA=n(38549);let eP={opacity:0,y:35},eF={opacity:1,y:0},eR={opacity:0,y:35},ez={duration:.25,type:"tween",ease:"anticipate"},eM=(0,O.PA)(function(e){var t,n,i,s,r,l;let{conversationId:o,recordingOnly:d=!1,identityFragmentRef:c,onSubmitTask:u,autoFocusInput:p=!0}=e,[v,f]=(0,V.useRefetchableFragment)(Y,c),y=(0,S.useCallback)(()=>{(0,S.startTransition)(()=>{f({nodeId:v.nodeId},{fetchPolicy:"store-and-network"})})},[v,f]),_=(0,eh.h)(),{attachments:b,getDeleteAttachment:k,openFileInput:C,getUploadedAttachments:j,clearAttachments:I}=(0,U.mT)(),T=b.length>0,N=null!==(l=(0,ep.T)())&&void 0!==l?l:"",A=(0,h.LM)(),F=(0,ef.b)(),z=(0,m.Fz)(),M=(0,ev.D)(e=>e.setIsComposingNewTask),D=(0,ev.D)(e=>e.isEditingTitle),{isElectron:O}=(0,P.Y0)(),Q=(0,x.v)(),B=(0,S.useRef)(null),[H,W]=(0,S.useState)(!1),[eM,eD]=(0,S.useState)(!1),{enabled:eL}=(0,el.u)(eS.T.BlockUserQueries,{defaultEnabled:!1}),{isPendingConversationStatusChange:eO,setIsPendingConversationStatusChange:eV}=(0,q.J)(),[eK,eQ]=(0,S.useState)(-1),{data:eB,invalidateQueries:eH}=(0,em.W)(),eU=(0,S.useRef)(null),eq=(0,S.useRef)(null),eW=(0,S.useRef)(null),{isMobileOnly:eY}=(0,P.Y0)(),[eZ,e$]=(0,S.useState)(""),eJ=(0,ex.C)(e=>{var t,n;return null!==(n=null===(t=e.agentPromptMap)||void 0===t?void 0:t[N])&&void 0!==n?n:""}),eX=(0,ex.C)(e=>e.setAgentPrompt),eG=(0,S.useCallback)(e=>{eX(N,e)},[N,eX]),e0=null===(t=v.billingInfo)||void 0===t?void 0:t.lastPaymentFailure,e1=e0?(0,eC.Vs)(new Date(e0.date)):0,e9=(0,S.useMemo)(()=>{var e,t;return(null===(t=v.billingInfo)||void 0===t?void 0:null===(e=t.creditsInfo)||void 0===e?void 0:e.creditBalance)===void 0||v.billingInfo.creditsInfo.creditBalance<=0},[v]),{upgradeToUsePremiumActions:e2}=function(){var e,t,n,a,i,s;let r=(0,ep.T)(),{arePremiumFeaturesEnabled:l}=(0,g.b)(),o=(0,V.useRelayEnvironment)(),d=(0,ec.I)({queryKey:["useHasPremiumFeaturesQuery",o,r],queryFn:async()=>(0,eu.fetchQuery)(o,eo,{id:(0,ed.F)("AgentDefinition",null!=r?r:"")}).toPromise(),enabled:!!r}),c=null!==(i=null===(t=d.data)||void 0===t?void 0:null===(e=t.node)||void 0===e?void 0:e.hasPremiumTriggers)&&void 0!==i&&i,u=null!==(s=null===(a=d.data)||void 0===a?void 0:null===(n=a.node)||void 0===n?void 0:n.hasPremiumActions)&&void 0!==s&&s;return(0,S.useMemo)(()=>({arePremiumFeaturesEnabled:l,hasPremiumActions:u,hasPremiumTriggers:c,upgradeToUsePremiumActions:u&&!1===l,upgradeToUsePremiumTriggers:c&&!1===l}),[l,u,c])}(),e4=(0,S.useMemo)(()=>{var e,t;return!F.isLoading&&(null==F?void 0:null===(e=F.data)||void 0===e?void 0:e.nodes.length)===0&&(null==F?void 0:null===(t=F.data)||void 0===t?void 0:t.edges.length)===0},[F]),e3=H||eO||(null===(i=A.data)||void 0===i?void 0:null===(n=i.labels)||void 0===n?void 0:n.includes(ey.G.BlockedOnAwaitingExternalWebhook))||!(0,w.h)(null===(s=A.data)||void 0===s?void 0:s.status),e5=!e9&&!e2&&(!e0||e1>0)&&!e3&&!eL,[e7,e8]=(0,S.useState)(!1),e6=(0,S.useCallback)(()=>{e8(!1)},[]);(0,S.useEffect)(()=>{var e;(null===(e=A.data)||void 0===e?void 0:e.status)&&(eV(!1),A.data.status!==E.Y.Cancelling?eD(!1):eD(!0))},[null===(r=A.data)||void 0===r?void 0:r.status,eV]);let te="string"==typeof o&&o.length>0?o:null;(0,S.useEffect)(()=>{eQ(-1),y()},[N,te,eG,y]),(0,S.useEffect)(()=>{var e;null==eU||null===(e=eU.current)||void 0===e||e.scrollTo(0,Number.MAX_SAFE_INTEGER)},[eJ]),(0,S.useEffect)(()=>{var e;p&&(null==eU||null===(e=eU.current)||void 0===e||e.focus())},[N,p]);let tt=(0,S.useCallback)(e=>{eG(t=>"".concat(t," ").concat(e).trim())},[eG]),tn=(0,S.useCallback)(e=>{eQ(-1),eG(e)},[eG]);(0,es.Q)(eU,[H?"":eJ,T]),(0,eg.p)(eU);let ta=(0,S.useCallback)(async e=>{W(!0),M(!1);try{let t=await u({task:e,attachments:await j()});if(!t)return e8(!0),null;let{conversationId:n,messageId:a}=t;return eV(!0),await eH(),o!==n&&(null==z||z.refetch(),null==Q||Q.storeConversationId(n)),{conversationId:n,messageId:a}}catch(e){return ej.Cp(e),e$((0,ew.SP)(e)),null}finally{W(!1)}},[M,u,j,eV,eH,o,z,Q,e8]),[ti,ts]=(0,S.useState)(!0),tr=(0,S.useCallback)(()=>{ts(e=>!e)},[]),tl=(0,S.useCallback)(()=>{ts(!0)},[]),to=(0,S.useMemo)(()=>e9?"Credit limit reached.":e2?"This Lindy uses premium actions.":null,[e9,e2]),td=(0,S.useCallback)(async e=>{if(null==e||e.preventDefault(),0!==eJ.length||T){if(!e5){e8(!0);return}if(e$(null),er.k.emit("task-input-submitted",eJ),await ta(eJ)&&(eG(""),I(),eQ(-1),eY)){var t;null===(t=eU.current)||void 0===t||t.blur()}}},[eJ,T,e5,ta,eG,I,eY]),tc=(0,eT.useRouter)().query.input,[tu,tp]=(0,S.useState)("string"==typeof tc?[tc]:null!=tc?tc:[]);(0,S.useEffect)(()=>{let e=tu[0];e5&&e&&_&&ta(e).then(e=>e&&tp(tu.slice(1)))},[e5,tu,_,ta]);let tm=(0,S.useCallback)(async e=>{var t,n,a,i;if("Enter"===e.key&&(eY||!e.shiftKey)&&(e.preventDefault(),eJ.length>0||T?(null===(t=eq.current)||void 0===t||t.requestSubmit(),null==Q||Q.submitQuery(eJ),ei.kN.startingOrStarted&&await ei.kN.stop()):eZ||null===(n=eW.current)||void 0===n||n.click()),eB&&(null==eB?void 0:eB.length)&&("ArrowUp"===e.key||"ArrowDown"===e.key)&&eJ===(null!==(a=eB[eK])&&void 0!==a?a:"")){let t=eB.length-1,n="ArrowUp"===e.key?eK+1:eK-1;n<-1&&(n=-1),n>t&&(n=t),eQ(n),eG(null!==(i=eB[n])&&void 0!==i?i:"")}return!0},[eY,eB,eJ,T,eZ,Q,eG,eK]);(0,S.useEffect)(()=>{if(eZ)return B.current=window.setTimeout(()=>{e$(null)},4e3),()=>{B.current&&window.clearTimeout(B.current)}},[eZ]);let th=(0,S.useCallback)(()=>{e$(null),B.current&&window.clearTimeout(B.current)},[]);(0,S.useEffect)(()=>{var e;!D&&p&&(null===(e=eU.current)||void 0===e||e.focus())},[o,D,p]);let tg=!!eZ,tv=(0,S.useCallback)(async()=>{!eM&&o&&(eD(!0),await (0,J.q)({params:{id:o}}))},[eM,o]),tf=e5&&N,tx=!!e3,ty=e9||e2,[t_,tb]=(0,S.useState)("auto");return((0,S.useEffect)(()=>{let e=()=>{eU.current&&tb(eU.current.offsetWidth-55)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),d)?(0,a.jsx)(ea.y,{onTranscript:tt,recordingOnly:!0}):(0,a.jsxs)("form",{ref:eq,className:"relative w-full",onSubmit:td,children:[(!!e0||ty)&&(0,a.jsx)("section",{className:(0,K.QP)("min-h-min",eE.XF?"bg-white dark:bg-slate-2":"bg-slate-1"),children:(0,a.jsx)(eI.N,{children:(0,a.jsxs)(L.P.div,{initial:eP,animate:eF,exit:eR,layout:!0,transition:ez,children:[ty&&(0,a.jsxs)("div",{className:"m-2 flex items-center gap-2 rounded-xl bg-slate-2 p-3 align-middle text-slate-11",children:[(0,a.jsx)("div",{className:"pt-px",children:(0,a.jsx)(eb.s,{})}),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:"text-left text-sm text-slate-12",children:[to," Please upgrade to resume."]}),(0,a.jsx)("span",{className:"text-sm text-slate-6",children:"â€¢"}),(0,a.jsx)("span",{className:"cursor-pointer text-sm text-[#007AFF]",onClick:tr,children:"Upgrade"})]})]}),e0&&(0,a.jsxs)("div",{className:"m-2 flex items-center gap-2 rounded-xl bg-slate-2 p-3 align-middle text-slate-11",children:[(0,a.jsx)("div",{className:"pt-px",children:(0,a.jsx)(eb.s,{})}),e1>0?(0,a.jsxs)("div",{className:"text-left text-sm text-slate-12",children:["Your last payment failed, please make a payment in"," ",e1," ",1===e1?"day":"days"," on the ",(0,a.jsx)(ee.N,{href:"/settings/billing",children:"Billing"})," page to avoid losing access."]}):(0,a.jsxs)("div",{className:"text-left text-sm text-slate-12",children:["Your last payment failed, please make a payment on the"," ",(0,a.jsx)(ee.N,{href:"/settings/billing",children:"Billing"})," page to restore access."]})]})]})})}),(0,a.jsxs)("div",{children:[eL&&(0,a.jsx)(G.F,{type:"warning",className:"mb-6",children:"New queries temporarily disabled due to high load. Please try again later."}),e4&&(0,a.jsx)(G.F,{type:"warning",className:"mb-6",children:(0,a.jsxs)("span",{children:["This Lindy is not configured yet. Please configure it in ",(0,a.jsx)("a",{href:"/graph/".concat(N),className:"text-primary-8 underline hover:text-primary-9",children:"settings"}),"."]})}),(0,a.jsx)(en.r,{submitQuery:ta}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(et.f,{id:"input","data-testid":"prompt-input",name:"input",ref:eU,value:H?"":eJ,placeholder:"Enter message",autoComplete:"off",onChange:tn,onKeyDown:tm,onAnimationEnd:e6,disabled:!N||e4,className:(0,K.QP)(R.Oc,"pr-[12px] pt-[10px] rounded-lg shadow-md resize-none max-h-64 bg-slate-1 disabled:opacity-70 hover:cursor-text",T?"pl-[12px] pb-[50px]":"pl-[38px] pb-[10px]",O?"dark:bg-slate-3":"dark:bg-slate-5",e7&&"animate__animated animate__headShake",(tf||tx)&&"pr-[80px]","mousetrap",N?"cursor-default":"cursor-not-allowed",(ty||e0)&&"mt-2")}),tf&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ea.y,{onTranscript:tt,absolutelyPositioned:!0}),(0,a.jsx)("div",{className:(0,K.QP)("absolute rounded-md top-[3px] right-[5px] h-[36px] w-[36px] flex justify-center items-center","bg-transparent hover:bg-slate-4 active:bg-slate-5"),"data-testid":"inputSubmission",onClick:td,children:(0,a.jsxs)(ek.m_,{children:[(0,a.jsx)(ek.ZI,{className:"flex flex-col items-center",children:"Send message"}),(0,a.jsx)(ek.k$,{children:(0,a.jsx)(e_.G,{className:(0,K.QP)(eJ.length||T?"fill-[#007AFF]":"fill-[#C1C6CD]","transition-all")})})]})})]}),tx&&(0,a.jsx)("div",{className:(0,K.QP)("absolute rounded-md top-[3px] right-[5px] h-[36px] w-[36px] flex justify-center items-center","bg-transparent hover:bg-slate-4 active:bg-slate-5",eM&&"animate-pulse cursor-not-allowed"),onClick:tv,children:(0,a.jsxs)(ek.m_,{children:[(0,a.jsx)(ek.ZI,{className:"flex flex-col items-center",children:(0,a.jsx)("div",{children:eM?"Stopping...":"Stop"})}),(0,a.jsx)(ek.k$,{children:(0,a.jsx)(Z.A,{className:"size-5 text-slate-12"})})]})}),(0,a.jsxs)("button",{type:"button",onClick:th,tabIndex:tg?0:-1,className:(0,K.QP)(tg?"opacity-100":"opacity-0 translate-y-5 pointer-events-none","flex items-center transition border border-transparent cursor-pointer px-2 py-1 rounded-md outline-none hover:bg-glass hover:border-slate-6 focus:bg-glass focus:border-slate-6 focus-visible:ring-2 focus-visible:ring-primary-8 focus-visible:ring-offset-2","absolute bottom-14 left-0 text-slate-12"),children:[(0,a.jsx)("div",{children:(0,a.jsx)($.A,{className:"mr-2.5 size-6 stroke-danger-9"})}),(0,a.jsx)("p",{className:"text-left text-sm",children:eZ})]}),(0,a.jsx)("div",{className:(0,K.QP)("absolute left-2",T?"bottom-0":"top-[7px]"),onClick:C,children:(0,a.jsxs)(ek.m_,{children:[(0,a.jsx)(ek.ZI,{className:"flex flex-col items-center",children:(0,a.jsx)("div",{children:"Upload File"})}),(0,a.jsx)(ek.k$,{children:(0,a.jsx)("div",{className:(0,K.QP)("rounded-md h-[27px] w-[27px] mb-[10px] flex justify-center items-center","bg-transparent",T?"bg-[#F5F2FF]":"hover:bg-slate-4 active:bg-slate-5"),children:(0,a.jsx)(eA.P,{className:(0,K.QP)("h-4 w-4",T?"text-[#6E56CF]":"text-[#C1C8CD]")})})})]})})]})]}),T&&(0,a.jsx)("div",{className:(0,K.QP)("absolute bottom-[5px] left-[44px] h-[36px] flex justify-center items-center gap-2","bg-transparent"),children:(0,a.jsx)("div",{style:{width:t_},children:(0,a.jsx)(eN.g,{attachments:b,getDeleteAttachment:k})})}),(0,a.jsx)(X.E,{identityFragmentRef:v,toggle:tl,hide:ti})]})});var eD=n(49193),eL=n(48571),eO=n(66903);let eV="16px",eK={paddingTop:eV,paddingBottom:eV},eQ=(0,O.PA)(function(e){var t,n,o;let{gqlQuery:d,agentDefinitionFragmentRef:c,onSubmitTask:u,className:O,autoFocusInput:W=!0,agentEnabled:Y,shouldRenderInput:Z=!0}=e,$=(0,M.jE)(),J=(0,eD.i)(),X=(0,V.useFragment)(i,d),G=(0,V.useFragment)(s,c);(0,T.B)();let ee=(0,j.U)(),{isElectron:et}=(0,P.Y0)(),en=(0,x.v)(),ea=(0,f.f)(),{isRailsTesting:ei}=(0,A.dn)(),{isMobileOnly:es}=(0,P.Y0)(),er=(0,r.ec)({query:{},params:{id:null!==(o=null===(t=ea.data)||void 0===t?void 0:t._id)&&void 0!==o?o:""}}),{data:el,conversationId:eo}=(0,h.LM)(),{mutate:ed,isLoading:ec}=(0,D.n)({mutationFn:async()=>{eo&&await (0,l.oA)(p({params:{id:eo}}))},onError:()=>{eo&&$.setQueryData(er,e=>(0,m.zT)({prev:e,conversationId:eo,update:{isSeen:!1}}))},onSettled:()=>{$.invalidateQueries([er])}}),eu=(0,Q.YQ)(ed,1e3,{leading:!0,maxWait:2e3}),ep=(0,S.useMemo)(()=>{if(!el||el.status!==E.Y.Blocked)return!1;let e=el.blocks.at(-1);return!!e&&(0,y.EJ)(e)&&((null==e?void 0:e.subType)===y.FY.CreditsExhausted||(null==e?void 0:e.subType)===y.FY.PaymentFailed)},[el]),em=z.a.ui.isLoggedInAsUser;(0,S.useEffect)(()=>{(null==el?void 0:el._id)&&(null==el||!el.isSeen)&&((null==el?void 0:el.status)!==E.Y.Blocked||ep)&&!em&&!ec&&($.setQueryData(er,e=>(0,m.zT)({prev:e,conversationId:el._id,update:{isSeen:!0}})),eu())},[em,null==el?void 0:el._id,null==el?void 0:el.isSeen,null==el?void 0:el.status,$,er,eu,ec,ep]),(0,S.useEffect)(()=>{null==en||en.onLoggedIn()},[en]);let eh=!!eo;!function(e){var t,n,a;let i=(0,x.v)(),s=(0,h.LM)(),r=(0,w.h)(null===(t=s.data)||void 0===t?void 0:t.status),l=null===(a=(0,f.f)(null===(n=s.data)||void 0===n?void 0:n.agentDefinitionId).data)||void 0===a?void 0:a.isMuted,o=(0,S.useMemo)(()=>{let t=(null!=e?e:[]).filter(e=>(0,k.h7)(e)),n=(0,C.A)(t,e=>e.ts.valueOf());switch(null==n?void 0:n.type){case y.Jl.ACTION_NEEDED_OAUTH2_AUTH:case y.Jl.ACTION_NEEDED_CUSTOM_AUTH:case y.Jl.ACTION_NEEDED_CUSTOM_OAUTH2:return"".concat(null==n?void 0:n.name," requires user authentication");case y.Jl.ACTION_NEEDED_API_TOKEN_AUTH:return"".concat(null==n?void 0:n.name," requires user API token");case y.Jl.INTERNAL_EXECUTION_TRACE:if(n.traceType===_.UA.ActionExecution&&(null==n?void 0:n.actionName))return"".concat((0,b.Ju)(n.actionName)," action has finished");return null;default:return null==n?void 0:n.text}},[e]);(0,S.useEffect)(()=>{r&&o&&!l&&function(e,t){if("Notification"in window&&"hidden"===document.visibilityState)try{new Notification("Lindy",{body:e,icon:"/notification-icon.png"}).addEventListener("click",t)}catch(e){}}(o,()=>{i?i.showMainWindow():window.focus()})},[r,i,o,l])}(null==el?void 0:el.blocks),(0,I.r)(),(0,S.useEffect)(()=>{ee.isSuccess&&(0,v.r)(!0)},[ee.isSuccess]);let eg=(0,S.useMemo)(()=>({type:"tween",duration:.2}),[]);if(ee.isLoading)return(0,a.jsx)(H.g,{pulse:!0});let ev=eh?(0,a.jsx)("div",{className:"h-full",children:(0,a.jsx)(eO.ju,{identityFragmentRef:X.me,agentDefinitionFragmentRef:G})}):(0,a.jsx)(F.V,{className:"h-full",children:!(null==el?void 0:el.onboarding)&&(0,a.jsx)(a.Fragment,{children:J?(0,a.jsx)(F.V,{middle:!0,className:"mb-12 h-full",children:(0,a.jsx)(B.l,{action:B.E.StartRecording})}):(null==ea?void 0:null===(n=ea.data)||void 0===n?void 0:n.greetingMessage)?(0,a.jsx)("div",{className:(0,K.QP)("max-w-[640px] w-full mx-auto mt-4",et?"pl-4 pr-8":"px-8"),style:eK,children:(0,a.jsx)(eL.h,{message:ea.data.greetingMessage,showAvatar:!0,"data-testid":"lindy.conversation-view.greeting-message"})}):(0,a.jsx)(F.V,{middle:!0,className:"mb-12 h-full",children:(0,a.jsx)(N.t,{})})})});return(0,a.jsx)("div",{className:(0,K.QP)("h-full w-full",O),children:(0,a.jsx)(U.gH,{allowMultiple:!0,acceptedTypes:"*",children:(0,a.jsx)(R.UU,{isMobile:es,children:(0,a.jsx)(q.e,{children:(0,a.jsxs)("div",{className:"flex size-full flex-col",children:[(0,a.jsx)("div",{className:"size-full overflow-y-auto",children:ev}),(0,a.jsx)("div",{className:(0,K.QP)("flex w-full items-center",ei?"pb-5":"pb-4"),children:(0,a.jsx)(L.P.div,{className:(0,K.QP)("mx-auto w-full max-w-2xl",ei?"px-5":"mb-4 sm:px-8 px-4"),transition:eg,children:Z?(0,a.jsx)(g.u,{identityFragmentRef:X.me,children:!1===Y?(0,a.jsx)("div",{className:"flex h-11 items-center rounded-lg border-orange-4 bg-orange-3 px-4 text-xs font-normal leading-none text-slate-11 shadow-md",children:"This Lindy is currently disabled. Turn it back on to continue making changes."}):(0,a.jsx)(eM,{conversationId:eo,identityFragmentRef:X.me,onSubmitTask:u,autoFocusInput:W})}):null})})]})})})})})})},98523:(e,t,n)=>{"use strict";n.d(t,{l:()=>f,E:()=>v});var a=n(50612),i=n(10293),s=n(31024),r=n(39274),l=n(90508),o=n(94344),d=n(23577),c=n(64880),u=n(4960),p=n(1656),m=n(67373),h=n(18153);let g=(0,o.memo)(function(){let e=(0,u.W)(),{micAllowed:t,handleMicNotAllowed:n,handleModalToggle:i,hideMicBlockModal:s}=(0,c.H)(),r=(0,o.useCallback)(()=>{t?p.kN.start(e):n()},[t,e,n]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.L,{toggle:i,hide:s}),(0,a.jsx)(m.$,{onClick:r,size:h.XF?"xl":"md",children:"Start Recording"})]})});var v=function(e){return e.StartRecording="Start Recording",e}({});let f=(0,o.memo)(function(e){var t,n;let{action:d}=e,{data:c}=(0,i.f)(),u=(0,o.useMemo)(()=>"Start Recording"===d?(0,a.jsx)(g,{}):null,[d]);if(!c)return null;let p=(0,l.hq)(null===(t=c.icon)||void 0===t?void 0:t.name),m=null===(n=c.icon)||void 0===n?void 0:n.color;return(0,a.jsxs)(s.V,{center:!0,className:"w-full max-w-[350px] select-none gap-y-6",children:[(0,a.jsxs)(s.V,{center:!0,children:[(0,a.jsx)(r.l,{icon:p,color:m,size:"md"}),(0,a.jsx)("div",{className:"cursor-pointer text-base font-semibold text-slate-12 hover:underline",children:null==c?void 0:c.name})]}),c.greetingMessage&&(0,a.jsx)("div",{className:"text-center text-xs text-slate-11",children:c.greetingMessage}),u]})})},47830:(e,t,n)=>{"use strict";n.d(t,{r:()=>f});var a=n(50612),i=n(72260),s=n(90996),r=n(21649),l=n(38001),o=n(10293),d=n(69507),c=n(9966),u=n(16008),p=n(35774),m=n(94344),h=n(25919),g=n(33762);let v="flex cursor-pointer items-center whitespace-prewrap rounded-lg border px-3 py-2 h-auto min-h-[42px] text-sm text-slate-11 shadow-sm hover:bg-slate-3 active:bg-slate-4 border-slate-6";function f(e){let{submitQuery:t}=e,n=(0,o.f)(),f=(0,l.LM)(),{isMobileOnly:x}=(0,d.Y0)(),y=(0,m.useRef)(null),_=(0,m.useRef)(null),b=(0,m.useMemo)(()=>{var e,t,a;return null!==(a=null===(t=n.data)||void 0===t?void 0:null===(e=t.conversationStarters)||void 0===e?void 0:e.map(e=>e.value))&&void 0!==a?a:[]},[n.data]),k=(0,m.useCallback)(e=>{let n=e.currentTarget.dataset.promptStarter;n&&t(n)},[t]),w=(0,m.useMemo)(()=>({visible:{opacity:1,transition:{when:"beforeChildren",duration:0,staggerChildren:.1}},hidden:{opacity:0,transition:{when:"afterChildren"}}}),[]),C=(0,m.useMemo)(()=>({visible:{opacity:1,y:0},hidden:{opacity:0,y:10}}),[]),[S,j]=(0,m.useState)(null),[I,T]=(0,m.useState)([]),E=(0,m.useCallback)(()=>{let e=y.current,t=_.current;if(!b.length||x||!e||!t)return;let n=Array.from(e.children).filter(e=>e instanceof HTMLLIElement),a=t.clientWidth,i=n.filter(e=>e.clientWidth).length,s=!1;if(e.scrollWidth>a)for(let t=n.length-1;t>=1;t--){let r=n[t];if(!r||e.scrollWidth<=a)break;r.style.display="none",i--,s=!0}else if(e.scrollWidth<a)for(let t=i;t<n.length;t++){let r=n[t];if(!r)break;if(r.style.display="block",e.scrollWidth>a){r.style.display="none";break}i++,s=!0}(s||(null==S?void 0:S.length)!==b.length||S.some((e,t)=>e.value!==b[t]))&&(j(b.map((e,t)=>({value:e,style:{display:t<i?"block":"none"}}))),T(b.slice(i)))},[b,S,x]),N=(0,m.useCallback)(()=>{x&&(j(b.map((e,t)=>({value:e,style:{display:t<4?"block":"none"}}))),T(b.slice(4)))},[b,x]);(0,c.A)(_,E),(0,m.useEffect)(()=>{x&&N()},[x,N,b]),(0,m.useEffect)(()=>{x||E(),b.length||(j(null),T([]))},[E,x,b]);let A=(0,m.useMemo)(()=>{var e;return S||(null!==(e=null==b?void 0:b.map(e=>({value:e,style:{display:"block"}})))&&void 0!==e?e:[])},[S,b]),P=(0,m.useRef)(null),[F,R]=(0,m.useState)(0);(0,g.Es)(()=>{P.current&&R(P.current.clientHeight)},[P.current]);let z=(0,m.useMemo)(()=>({bottom:"calc(".concat(F,"px + 1rem)")}),[F]),M=I.length>0;return(0,a.jsx)("div",{className:"flex w-full flex-col",ref:_,children:(0,a.jsxs)(i.AM,{className:"relative w-full","data-testid":"lindy.conversation-view.prompt-starters.show-more",children:[(0,a.jsx)(u.N,{children:!f.data&&!!(null==A?void 0:A.length)&&(0,a.jsxs)(p.P.ul,{initial:"hidden",animate:"visible",variants:w,className:(0,h.QP)("flex w-full gap-2 py-2 leading-6",x&&"overflow-x-auto"),ref:y,children:[M&&(0,a.jsx)(i.AM.Button,{ref:P,children:(0,a.jsx)(p.P.li,{variants:C,className:v,children:(0,a.jsx)(r.A,{className:"h-6 w-6"})})}),A.map(e=>(0,a.jsx)(p.P.li,{variants:C,className:(0,h.QP)(v),onClick:k,style:e.style,"data-testid":"lindy.conversation-view.prompt-starters.pill","data-prompt-starter":e.value,children:e.value},e.value))]})}),(0,a.jsx)(s.e,{enter:"transition duration-100 ease-out",enterFrom:"transform scale-95 opacity-0",enterTo:"transform scale-100 opacity-100",leave:"transition duration-75 ease-out",leaveFrom:"transform scale-100 opacity-100",leaveTo:"transform scale-95 opacity-0",children:(0,a.jsx)(i.AM.Panel,{className:(0,h.QP)("absolute bg-white dark:bg-slate-2 rounded-lg shadow","flex w-60 flex-col gap-1 p-2 left-0"),style:z,children:I.map((e,t)=>(0,a.jsx)("button",{className:"rounded border border-transparent px-2 py-1 text-left text-sm text-slate-12 hover:border-slate-4","data-testid":"lindy.conversation-view.prompt-starters.show-more-item","data-prompt-starter":e,onClick:k,children:e},t))})})]})})}},51847:(e,t,n)=>{"use strict";n.d(t,{g:()=>l});var a=n(50612),i=n(62813),s=n(94344),r=n(47716);let l=(0,s.memo)(function(e){let{attachments:t,getDeleteAttachment:n}=e;return(0,a.jsx)(i.F,{type:i.z.ATTACHMENT,children:t.map((e,t)=>(0,a.jsx)(r.C,{attachment:e,deleteAttachment:n(e)},e.name+t))})})},38549:(e,t,n)=>{"use strict";n.d(t,{P:()=>i});var a=n(50612);let i=(0,n(94344).memo)(function(e){return(0,a.jsx)("svg",{width:"12",height:"14",viewBox:"0 0 12 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,a.jsx)("path",{d:"M6.13747 6.19843L2.81887 9.51865C2.45231 9.88539 2.45231 10.48 2.81887 10.8467C3.18544 11.2135 3.77975 11.2135 4.14631 10.8467L10.7835 4.20629C11.15 3.83958 11.3333 3.35896 11.3333 2.87833C11.3334 2.39761 11.1501 1.91689 10.7835 1.55011C10.4169 1.18338 9.93651 1.00001 9.45608 1C8.97564 0.999994 8.49519 1.18336 8.12862 1.55011L1.49144 8.19056C0.941561 8.74071 0.66664 9.46177 0.666672 10.1828C0.666703 10.9038 0.941624 11.6248 1.49144 12.1748C2.04128 12.725 2.76195 13 3.48262 13C4.20326 13 4.92391 12.7249 5.47375 12.1748L8.79234 8.85461",stroke:"currentColor",strokeWidth:"1.33333",strokeLinecap:"round"})})})},42598:(e,t,n)=>{"use strict";n.d(t,{gH:()=>u,mT:()=>m});var a=n(50612),i=n(96536),s=n(85680),r=n(52105),l=n(91777),o=n(89275),d=n(94344),c=n(25919);function u(e){let{children:t,allowMultiple:n,acceptedTypes:i=["txt","csv","pdf","png","jpg","jpeg","gif"],hoverText:r="Drop files here to add them to the conversation",onUpload:u}=e,m=(0,s.aV)(),[g,v]=(0,d.useState)(!1),f=(0,d.useCallback)(e=>{e.preventDefault(),e.dataTransfer.types.includes("Files")&&v(!0)},[]),x=(0,d.useCallback)(e=>{e.preventDefault(),v(!1)},[]),[y,_]=(0,d.useState)([]),[b,k]=(0,d.useState)(null),[w,C]=(0,d.useState)(null),S=(0,d.useCallback)(()=>{if(b)return b;if(y.every(e=>e.uploaded&&e.attachmentId))return Promise.resolve(y);let e=new Promise(e=>{C(()=>t=>{e(t)})});return k(e),e},[y,b]),j=(0,d.useCallback)(e=>{let t=Array.from(e),n=t.filter(e=>{var t;let n=null===(t=e.name.split(".").pop())||void 0===t?void 0:t.toLowerCase();return!!n&&("*"===i||i.includes(n))});if(n.length<t.length){let e=new Intl.ListFormat("en",{style:"long",type:"conjunction"});m({message:"Only ".concat("*"===i?"certain types of":e.format(i)," files are allowed."),level:"danger",duration:5e3})}let a=n.map(e=>({key:(0,l.gZ)(),file:e,name:e.name,uploaded:!1}));_(e=>[...e,...a]),h(a).then(e=>{for(let t of(_(t=>{let n=[];return t.forEach(t=>{let a=e.find(e=>e.key===t.key);if(!a||a.uploaded){if(a){n.push({...t,attachmentId:a.attachmentId,uploaded:!0});return}n.push(t)}}),w&&n.every(e=>e.uploaded)&&w(n),null==u||u(n),n}),e))!t.uploaded&&t.failureReason&&m({message:t.failureReason,level:"warning",duration:5e3})}).catch(e=>{m({message:e.type===o.r.UserFacingError?e.message:"Error uploading attachments",level:"danger",duration:5e3}),_(e=>{let t=e.filter(e=>!a.some(t=>t.key===e.key));return w&&t.every(e=>e.uploaded)&&w(t),t})})},[i,w,m,u]),I=(0,d.useCallback)(e=>{e.preventDefault(),j(e.dataTransfer.files),v(!1)},[j]),T=(0,d.useCallback)(e=>{e.preventDefault();let t=e.target;t.files&&j(t.files),t.value=""},[j]),E=(0,d.useCallback)(e=>{_(t=>t.filter(t=>t.key!==e.key))},[]),N=(0,d.useCallback)(e=>()=>{E(e)},[E]),A=(0,d.useCallback)(()=>{_([])},[]),P=(0,d.useRef)(null),F=(0,d.useCallback)(()=>{var e;null===(e=P.current)||void 0===e||e.click()},[]),R=(0,d.useCallback)(async e=>{var t;let n=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(!n)return;let a=Array.from(n).filter(e=>{if(!e.type)return!1;let[t,n]=e.type.split("/");return"text"!==t&&("*"===i||("image"===t?i.some(e=>e===n||"jpg"===e&&"jpeg"===n||"jpeg"===e&&"jpg"===n):i.some(t=>e.type.endsWith("/".concat(t)))))});if(0===a.length)return;e.preventDefault();let s=a.map(e=>{let t=e.getAsFile();if(!t)return null;let n="image.png"!==t.name&&t.name?t.name:"pasted-file-".concat(Date.now(),".").concat(e.type.split("/")[1]||"bin");return new File([t],n,{type:e.type})}).filter(e=>null!==e);if(0===s.length)return;let r=new DataTransfer;s.forEach(e=>r.items.add(e)),j(r.files)},[j,i]),z=(0,d.useMemo)(()=>({attachments:y,deleteAttachment:E,getDeleteAttachment:N,openFileInput:F,getUploadedAttachments:S,clearAttachments:A,handlePaste:R}),[y,E,N,F,S,A,R]);return(0,a.jsxs)("div",{className:"relative size-full",onDragOver:f,onDragLeave:x,onDrop:I,children:[(0,a.jsx)(p.Provider,{value:z,children:t}),(0,a.jsxs)("div",{className:(0,c.QP)("absolute z-40 inset-0 flex items-center justify-center opacity-0 pointer-events-none  transition-opacity duration-200",g&&"opacity-100"),children:[(0,a.jsx)("div",{className:"absolute size-full bg-panel opacity-90"}),(0,a.jsxs)("div",{className:"z-50 flex w-full flex-col items-center justify-center gap-2 text-center",children:[(0,a.jsx)("div",{className:"text-xl font-semibold text-slate-12",children:r}),"*"!==i&&(0,a.jsxs)("div",{className:"text-slate-12",children:["Accepted Types: ",i.map(e=>"."+e).join(", ")]})]}),(0,a.jsx)("input",{ref:P,type:"file",className:"hidden",onChange:T,multiple:n,accept:"*"===i?"*":i.map(e=>"."+e).join(",")})]})]})}let p=(0,d.createContext)({attachments:[],deleteAttachment:()=>{},getDeleteAttachment:()=>()=>{},openFileInput:()=>{},getUploadedAttachments:()=>Promise.resolve([]),clearAttachments:()=>{},handlePaste:()=>{}}),m=()=>(0,d.useContext)(p);async function h(e){let t=await Promise.all(e.map(async e=>{let t=new FormData;t.append("attachment",e.file,e.name);let{attachmentId:n,failureReason:a}=await (0,r.oA)((0,i.N)({query:{filename:e.name},body:t},{headers:{}}));return{attachmentId:n,failureReason:a}}));return e.map((e,n)=>{var a,i;let s=null===(a=t[n])||void 0===a?void 0:a.failureReason,r=null===(i=t[n])||void 0===i?void 0:i.attachmentId;return s?{...e,uploaded:!1,failureReason:s}:{...e,attachmentId:r,uploaded:!0}})}},31173:(e,t,n)=>{"use strict";n.d(t,{y:()=>P});var a=n(50612),i=n(4960),s=n(85680),r=n(94344);let l=(0,r.memo)(function(e){let{className:t}=e;return(0,a.jsxs)("svg",{className:t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",strokeWidth:".5",stroke:"#C1C8CD",children:[(0,a.jsx)("path",{fill:"#C1C8CD",d:"M7 4C7 3.20435 7.31607 2.44129 7.87868 1.87868C8.44129 1.31607 9.20435 1 10 1C10.7956 1 11.5587 1.31607 12.1213 1.87868C12.6839 2.44129 13 3.20435 13 4V10C13 10.7956 12.6839 11.5587 12.1213 12.1213C11.5587 12.6839 10.7956 13 10 13C9.20435 13 8.44129 12.6839 7.87868 12.1213C7.31607 11.5587 7 10.7956 7 10V4Z"}),(0,a.jsx)("path",{strokeWidth:"0px",fill:"#C1C8CD",d:"M5.5 9.64307C5.5 9.44415 5.42098 9.25339 5.28033 9.11274C5.13968 8.97208 4.94891 8.89307 4.75 8.89307C4.55109 8.89307 4.36032 8.97208 4.21967 9.11274C4.07902 9.25339 4 9.44415 4 9.64307V10.0001C4 13.0601 6.29 15.5851 9.25 15.9541V17.5001H7.75C7.55109 17.5001 7.36032 17.5791 7.21967 17.7197C7.07902 17.8604 7 18.0512 7 18.2501C7 18.449 7.07902 18.6397 7.21967 18.7804C7.36032 18.9211 7.55109 19.0001 7.75 19.0001H12.25C12.4489 19.0001 12.6397 18.9211 12.7803 18.7804C12.921 18.6397 13 18.449 13 18.2501C13 18.0512 12.921 17.8604 12.7803 17.7197C12.6397 17.5791 12.4489 17.5001 12.25 17.5001H10.75V15.9541C12.2 15.7712 13.5335 15.0654 14.5001 13.9691C15.4667 12.8729 16 11.4616 16 10.0001V9.64307C16 9.44415 15.921 9.25339 15.7803 9.11274C15.6397 8.97208 15.4489 8.89307 15.25 8.89307C15.0511 8.89307 14.8603 8.97208 14.7197 9.11274C14.579 9.25339 14.5 9.44415 14.5 9.64307V10.0001C14.5 11.1935 14.0259 12.3381 13.182 13.182C12.3381 14.026 11.1935 14.5001 10 14.5001C8.80653 14.5001 7.66193 14.026 6.81802 13.182C5.97411 12.3381 5.5 11.1935 5.5 10.0001V9.64307Z"}),(0,a.jsx)("defs",{})]})}),o=(0,r.memo)(function(e){let{className:t}=e;return(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",className:t,children:[(0,a.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18.0284 1.97172C18.4352 2.37852 18.4352 3.03807 18.0284 3.44486L2.83487 18.6384C2.42807 19.0452 1.76853 19.0452 1.36173 18.6384C0.954934 18.2316 0.954934 17.572 1.36173 17.1653L16.5553 1.97172C16.9621 1.56493 17.6216 1.56493 18.0284 1.97172Z",fill:"#E5484D"}),(0,a.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13 4.11265V4C13 3.20435 12.6839 2.44129 12.1213 1.87868C11.5587 1.31607 10.7956 1 10 1C9.20435 1 8.44129 1.31607 7.87868 1.87868C7.31607 2.44129 7 3.20435 7 4V10C7 10.0369 7.00068 10.0738 7.00204 10.1106L13 4.11265ZM13 9.88735L9.88939 12.998C9.92618 12.9993 9.96305 13 10 13C10.7956 13 11.5587 12.6839 12.1213 12.1213C12.6839 11.5587 13 10.7956 13 10V9.88735ZM5.7207 11.3919C5.57579 10.9465 5.5 10.4771 5.5 9.99994V9.64294C5.5 9.44403 5.42098 9.25327 5.28033 9.11261C5.13968 8.97196 4.94891 8.89294 4.75 8.89294C4.55109 8.89294 4.36032 8.97196 4.21967 9.11261C4.07902 9.25327 4 9.44403 4 9.64294V9.99994C4 10.9106 4.2028 11.7738 4.5657 12.5469L5.7207 11.3919ZM7.45286 15.4345L8.60808 14.2793C9.05352 14.4242 9.52285 14.4999 10 14.4999C11.1935 14.4999 12.3381 14.0258 13.182 13.1819C14.0259 12.338 14.5 11.1934 14.5 9.99994V9.64294C14.5 9.44403 14.579 9.25327 14.7197 9.11261C14.8603 8.97196 15.0511 8.89294 15.25 8.89294C15.4489 8.89294 15.6397 8.97196 15.7803 9.11261C15.921 9.25327 16 9.44403 16 9.64294V9.99994C16 11.4615 15.4667 12.8728 14.5001 13.969C13.5335 15.0652 12.2 15.771 10.75 15.9539V17.4999H12.25C12.4489 17.4999 12.6397 17.579 12.7803 17.7196C12.921 17.8603 13 18.051 13 18.2499C13 18.4489 12.921 18.6396 12.7803 18.7803C12.6397 18.9209 12.4489 18.9999 12.25 18.9999H7.75C7.55109 18.9999 7.36032 18.9209 7.21967 18.7803C7.07902 18.6396 7 18.4489 7 18.2499C7 18.051 7.07902 17.8603 7.21967 17.7196C7.36032 17.579 7.55109 17.4999 7.75 17.4999H9.25V15.9539C8.61476 15.8748 8.01037 15.6963 7.45286 15.4345Z",fill:"#889096"})]})});var d=n(66679),c=n(25919),u=n(23577),p=n(73850),m=n(69507),h=n(31634),g=n(67373),v=n(31024),f=n(76804),x=n(18153),y=n(88898),_=n.n(y);let b=(0,r.memo)(function(e){let{isPaused:t=!1}=e;return(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsxs)("div",{className:"flex h-12 space-x-3",children:[(0,a.jsx)("div",{className:(0,c.QP)("h-10 w-4 rounded-full bg-blue-6",!t&&_().pulseAnimation,t&&"h-6")}),(0,a.jsx)("div",{className:(0,c.QP)("h-10 w-4 rounded-full bg-blue-8",!t&&_().pulseAnimation,!t&&_().delay10,t&&"h-6")}),(0,a.jsx)("div",{className:(0,c.QP)("h-8 w-4 rounded-full bg-blue-9",!t&&_().pulseAnimation,!t&&_().delay80,t&&"h-6")}),(0,a.jsx)("div",{className:(0,c.QP)("h-12 w-4 rounded-full bg-blue-7",!t&&_().pulseAnimation,!t&&_().delay30,t&&"h-6")}),(0,a.jsx)("div",{className:(0,c.QP)("h-12 w-4 rounded-full bg-blue-9",!t&&_().pulseAnimation,!t&&_().delay50,t&&"h-6")}),(0,a.jsx)("div",{className:(0,c.QP)("h-9 w-4 rounded-full bg-blue-8",!t&&_().pulseAnimation,!t&&_().delay20,t&&"h-6")}),(0,a.jsx)("div",{className:(0,c.QP)("h-10 w-4 rounded-full bg-blue-9",!t&&_().pulseAnimation,!t&&_().delay40,t&&"h-6")}),(0,a.jsx)("div",{className:(0,c.QP)("h-10 w-4 rounded-full bg-blue-8",!t&&_().pulseAnimation,t&&"h-6")})]})})}),k=(0,r.memo)(function(e){let{stop:t,pause:n,resume:i,timer:s,isSubmitting:l,recording:o,recorderEnabled:d}=e,c=(0,r.useCallback)(async()=>{await t()},[t]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.f,{center:!0,className:"w-full text-2xl font-semibold text-slate-12",children:"Recording"}),(0,a.jsx)(h.f,{center:!0,className:"w-full py-4",children:(0,a.jsx)(b,{isPaused:!o||l})}),(0,a.jsx)(h.f,{center:!0,className:"w-full",children:(0,a.jsx)(v.V,{className:"rounded-full bg-slate-3 px-6 py-3",children:(0,a.jsx)("span",{className:"text-xl font-semibold text-slate-11",children:(e=>{let t=Math.floor(e/60);return"".concat(t,":").concat((e%60).toString().padStart(2,"0"))})(s)})})}),(0,a.jsxs)(v.V,{className:"w-full gap-y-4",children:[(0,a.jsx)(h.f,{center:!0,className:"w-full",children:(0,a.jsx)(g.$,{className:"w-full",size:x.XF?"lg":"md",level:"outline",onClick:o?n:i,disabled:!d,children:o?"Pause Recording":"Resume Recording"})}),(0,a.jsx)(h.f,{center:!0,className:"w-full",children:(0,a.jsx)(g.$,{className:"w-full",size:x.XF?"lg":"md",onClick:c,disabled:l,children:l?(0,a.jsxs)(h.f,{middle:!0,className:"gap-y-8",children:[(0,a.jsx)(f.y,{size:"md",className:"stroke-slate-1"}),(0,a.jsx)("span",{children:"Processing audio"})]}):"End Recording"})})]})]})}),w=(0,r.memo)(function(e){let{open:t,stop:n,pause:i,resume:s,timer:r,recording:l,isSubmitting:o,recorderEnabled:d}=e,{isMobileOnly:u}=(0,m.Y0)();return(0,a.jsx)(p.aF,{open:t,className:(0,c.QP)("gap-y-12 p-24"),alignToTop:u,shouldFitContent:u,shouldBlurBackground:!1,children:(0,a.jsx)(k,{stop:n,pause:i,resume:s,timer:r,recording:l,isSubmitting:o,recorderEnabled:d})})});var C=n(11827),S=n.n(C);function j(e){let{animate:t,className:n}=e;return(0,a.jsxs)("svg",{className:(0,c.QP)(t&&S().animate,n,"h-[20px]"),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",strokeWidth:"1",stroke:"#868c91",children:[(0,a.jsx)("path",{fill:"url(#bottom-to-top)",d:"M7 4C7 3.20435 7.31607 2.44129 7.87868 1.87868C8.44129 1.31607 9.20435 1 10 1C10.7956 1 11.5587 1.31607 12.1213 1.87868C12.6839 2.44129 13 3.20435 13 4V10C13 10.7956 12.6839 11.5587 12.1213 12.1213C11.5587 12.6839 10.7956 13 10 13C9.20435 13 8.44129 12.6839 7.87868 12.1213C7.31607 11.5587 7 10.7956 7 10V4Z"}),(0,a.jsx)("path",{strokeWidth:".1",fill:"#868c91",d:"M5.5 9.64307C5.5 9.44415 5.42098 9.25339 5.28033 9.11274C5.13968 8.97208 4.94891 8.89307 4.75 8.89307C4.55109 8.89307 4.36032 8.97208 4.21967 9.11274C4.07902 9.25339 4 9.44415 4 9.64307V10.0001C4 13.0601 6.29 15.5851 9.25 15.9541V17.5001H7.75C7.55109 17.5001 7.36032 17.5791 7.21967 17.7197C7.07902 17.8604 7 18.0512 7 18.2501C7 18.449 7.07902 18.6397 7.21967 18.7804C7.36032 18.9211 7.55109 19.0001 7.75 19.0001H12.25C12.4489 19.0001 12.6397 18.9211 12.7803 18.7804C12.921 18.6397 13 18.449 13 18.2501C13 18.0512 12.921 17.8604 12.7803 17.7197C12.6397 17.5791 12.4489 17.5001 12.25 17.5001H10.75V15.9541C12.2 15.7712 13.5335 15.0654 14.5001 13.9691C15.4667 12.8729 16 11.4616 16 10.0001V9.64307C16 9.44415 15.921 9.25339 15.7803 9.11274C15.6397 8.97208 15.4489 8.89307 15.25 8.89307C15.0511 8.89307 14.8603 8.97208 14.7197 9.11274C14.579 9.25339 14.5 9.44415 14.5 9.64307V10.0001C14.5 11.1935 14.0259 12.3381 13.182 13.182C12.3381 14.026 11.1935 14.5001 10 14.5001C8.80653 14.5001 7.66193 14.026 6.81802 13.182C5.97411 12.3381 5.5 11.1935 5.5 10.0001V9.64307Z"}),(0,a.jsx)("defs",{children:(0,a.jsxs)("linearGradient",{id:"bottom-to-top",x1:"1",x2:"1",y1:"1",y2:"0",children:[(0,a.jsx)("stop",{stopColor:"".concat(t?"#ec8f91":"transparent"),children:(0,a.jsx)("animate",{dur:"1.4s",repeatCount:"indefinite",attributeName:"offset",values:".2;.99;.4;.6;.5;.6;.4;.25"})}),(0,a.jsx)("stop",{stopColor:"".concat(t?"#868c91":"transparent"),children:(0,a.jsx)("animate",{dur:"1.4s",repeatCount:"indefinite",attributeName:"offset",values:".2;.99.4;.6;.5;.6;.4;.25"})})]})})]})}let I=(e,t)=>{let[n,a]=(0,r.useState)(0),i=(0,r.useRef)(0),s=(0,r.useRef)(null),l=(0,r.useRef)(null),o=(0,r.useCallback)(()=>{null!==l.current&&(clearInterval(l.current),l.current=null)},[]),d=(0,r.useCallback)(()=>{s.current&&a(Math.floor((new Date().getTime()-s.current.getTime())/1e3)+i.current)},[]);return(0,r.useEffect)(()=>{if(e&&!t)null===l.current&&(s.current=new Date,l.current=setInterval(d,1e3));else{if(s.current){let e=(Date.now()-s.current.getTime())/1e3;i.current+=Math.floor(e)}o()}return()=>o()},[e,t,o,d]),(0,r.useEffect)(()=>()=>{o(),a(0),i.current=0,s.current=null},[o]),n};var T=n(1656);let E=(0,r.memo)(function(e){let{onStop:t,onPause:n,onResume:i,recordingOnly:s=!1,showRecordingModal:r,state:l}=e,o=l===T.V_.Started,d=l===T.V_.Stopping,c=o||l===T.V_.Paused,u=I(o,d);return s?(0,a.jsx)(w,{stop:t,pause:n,resume:i,timer:u,open:!!r,recording:o,recorderEnabled:c,isSubmitting:d}):(0,a.jsxs)("div",{className:"absolute left-0 flex h-9 w-full min-w-full pl-2.5 text-zinc-500",onClick:o?t:void 0,children:[(0,a.jsx)("div",{className:"animate-fade-in self-center text-[13px]",children:o?"Stop":(0,a.jsx)(f.y,{size:"sm",className:"ml-1 stroke-slate-10"})}),(0,a.jsx)("div",{className:"absolute -right-px h-9 max-h-[36px] w-9",children:(0,a.jsx)("div",{className:"absolute left-1/2 top-1/2 flex w-9 max-w-[36px] -translate-x-1/2  -translate-y-1/2 justify-center text-center",children:(0,a.jsx)(j,{animate:o})})})]})});var N=n(64880),A=n(49193);let P=(0,r.memo)(function(e){let{onTranscript:t,recordingOnly:n=!1,absolutelyPositioned:p=!1}=e,m=(0,A.i)(),h=(0,i.W)(),{micAllowed:g,setMicAllowed:v,handleMicNotAllowed:f,handleModalToggle:x,hideMicBlockModal:y}=(0,N.H)(),[_,b]=(0,r.useState)(T.V_.Stopped),k=(0,s.aV)(),w=(0,s.hT)(),C=(0,r.useRef)("");(0,r.useEffect)(()=>(T.kN.on(T.IV.StateChange,b),T.kN.on(T.IV.Transcript,t),T.kN.on(T.IV.Error,(e,t)=>{C.current&&w(C.current),(null==t?void 0:t.name)==="NotAllowedError"&&v(!1);let n=k({level:"danger",message:e,duration:5e3});C.current=n.id}),()=>{T.kN.removeAllListeners()}),[w,v,k,t]);let S=(n||m)&&_!==T.V_.Stopped,j=(0,r.useCallback)(async()=>{g?T.kN.start(h):f()},[g,h,f]),I=(0,r.useCallback)(async()=>{await T.kN.stop()},[]),P=(0,r.useCallback)(async()=>{await T.kN.pause()},[]),F=(0,r.useCallback)(async()=>{await T.kN.resume()},[]),R=_!==T.V_.Stopped;return n||m&&S&&g?g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.L,{toggle:x,hide:y}),R&&(0,a.jsx)(E,{state:_,onStop:I,onPause:P,onResume:F,recordingOnly:!0,showRecordingModal:S})]}):null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.L,{toggle:x,hide:y}),(0,a.jsx)("div",{className:(0,c.QP)("cursor-pointer border-none rounded max-h-[36px] h-[36px] border text-[12px] box-border z-5",p&&"absolute top-[3px] left-[calc(100%-72px-5px)]",R?"bg-red-50 hover:bg-danger-4 active:bg-danger-5 w-[72px] transition-width":"bg-transparent hover:bg-slate-4 active:bg-slate-5 w-[36px]"),children:R&&!m?(0,a.jsx)(E,{state:_,onStop:I,onPause:P,onResume:F}):(0,a.jsx)("div",{className:"absolute left-1/2 top-1/2 flex w-[36px] max-w-[36px] -translate-x-1/2 -translate-y-1/2 justify-center text-center",onClick:j,children:g?(0,a.jsxs)(d.m_,{children:[(0,a.jsx)(d.ZI,{children:"Voice message"}),(0,a.jsx)(d.k$,{children:(0,a.jsx)(l,{className:"h-[20px]"})})]}):(0,a.jsxs)(d.m_,{children:[(0,a.jsxs)(d.ZI,{className:"flex flex-col items-center",children:[(0,a.jsx)("div",{children:"Permissions denied."}),(0,a.jsx)("div",{children:"Click to learn more."})]}),(0,a.jsx)(d.k$,{children:(0,a.jsx)(o,{className:(0,c.QP)(" h-[20px] w-[20px]")})})]})})})]})})},23577:(e,t,n)=>{"use strict";n.d(t,{L:()=>l});var a=n(50612),i=n(86383),s=n(73850),r=n(67373);let l=e=>{var t;let{toggle:n,hide:l}=e;return(0,a.jsxs)(s.aF,{open:!l,setClosed:n,children:[(0,a.jsxs)("div",{className:"flex w-full items-center justify-between text-[16px] font-semibold",children:[(0,a.jsx)("div",{children:"Microphone is blocked"}),(0,a.jsx)(i.A,{onClick:n,className:"h-5 w-5 cursor-pointer text-slate-11 hover:text-slate-12 active:text-slate-11"})]}),(0,a.jsxs)("p",{className:"text-[14px] text-zinc-600",children:['Choose "Safari" ',">",' "Settings for'," ",null!==(t="https://chat.lindy.ai".replace(/http:\/\/|https:\/\//,""))&&void 0!==t?t:"",'"']}),(0,a.jsx)("div",{className:"self-end pt-5",children:(0,a.jsx)(r.$,{onClick:n,className:"w-fit px-6  text-zinc-600",level:"outline",children:"Dismiss"})})]})}},64880:(e,t,n)=>{"use strict";n.d(t,{H:()=>l});var a=n(67094),i=n(22362),s=n(94344),r=n(67418);function l(){let e=(0,a.I)(),[t,n]=(0,s.useState)(!0),[l,o]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{!async function(){try{if(e){let e=await i.t.requestPermissions();"denied"===e.microphone&&n(!1)}else{let e=await navigator.permissions.query({name:"microphone"});"denied"===e.state&&n(!1)}}catch(e){}}()},[e]),{micAllowed:t,setMicAllowed:n,handleMicNotAllowed:(0,s.useCallback)(()=>{"Safari"===(0,r.c)()?o(!1):e?window.open("app-settings:","_blank"):window.open("https://support.google.com/chrome/answer/2693767?visit_id=638341240885877199-1906401443&p=ui_voice_search&rd=1#change","_blank")},[e]),handleModalToggle:(0,s.useCallback)(()=>{o(!0)},[o]),hideMicBlockModal:l}}},49193:(e,t,n)=>{"use strict";n.d(t,{i:()=>l});var a=n(7230),i=n(25347),s=n(14306),r=n(94344);let l=()=>{let{speechToTextModalMode:e,sensitive:t}=(0,a.O)(),{enabled:n,payload:l}=(0,i.u)(s.T.RecordingExperience,{defaultEnabled:!0,defaultPayload:"new"}),[o,d]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{d((e||t)&&n&&"new"===l)},[n,l,e,t]),o}},4960:(e,t,n)=>{"use strict";n.d(t,{W:()=>o});var a=n(32519),i=n(7230),s=n(77576),r=n(18983),l=n(94344);let o=()=>{var e,t;let n=(0,s.U)(),{defaultSpeechToTextModel:o}=(0,i.O)();return(0,l.useMemo)(()=>{var e,t;let i=null===(t=n.data)||void 0===t?void 0:null===(e=t.settings)||void 0===e?void 0:e.speechToTextModel;return i&&Object.values(r.a).includes(i)?(0,a.F3)(i):(0,a.F3)(o)},[o,null===(t=n.data)||void 0===t?void 0:null===(e=t.settings)||void 0===e?void 0:e.speechToTextModel])}},1656:(e,t,n)=>{"use strict";n.d(t,{kN:()=>M,IV:()=>P,V_:()=>F});var a=n(14952),i=n(32419),s=n(60588);let r=()=>MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm;codecs=pcm")?"audio/webm;codecs=pcm":MediaRecorder.isTypeSupported("audio/ogg")?"audio/ogg":MediaRecorder.isTypeSupported("audio/ogg;codecs=opus")?"audio/ogg;codecs=opus":MediaRecorder.isTypeSupported("audio/mp4;codecs=mp4a")?"audio/mp4;codecs=mp4a":"audio/webm";var l=n(67434),o=n(23871),d=function(e){return e.Data="data",e.Error="error",e}({});class c extends s.b{start(e){var t,n,a;if((null===(t=this.mediaRecorder)||void 0===t?void 0:t.state)==="recording"||(null===(n=this.mediaRecorder)||void 0===n?void 0:n.state)==="paused"){i.z.capture("speech_to_text_media_recorder_start_called_in_invalid_state",{state:null===(a=this.mediaRecorder)||void 0===a?void 0:a.state,timeStamp:new Date().toISOString(),counter:this.counter,streamActive:e.active,eventTrigger:"Start attempted in invalid state"});return}this.destroy(),this.mediaRecorder=new MediaRecorder(e,{mimeType:r()}),this.mediaRecorder.addEventListener("dataavailable",this.handleData),this.mediaRecorder.addEventListener("error",e=>this.handleError(e));try{this.mediaRecorder.start(250)}catch(n){let t=n instanceof DOMException?"".concat(n.name," ").concat(n.message," ").concat(n.cause).trim():"Unknown error";i.z.capture("speech_to_text_media_recorder_start_error",{error:t,streamActive:e.active,supportedMimeType:r()})}this.requestWakeLock(),i.z.capture("speech_to_text_media_recorder_start",{timeStamp:new Date().toISOString(),counter:this.counter,streamActive:e.active,supportedMimeType:r(),initialMediaRecorderState:this.mediaRecorder.state})}stop(){var e,t,n,a,s,r;if((null===(e=this.mediaRecorder)||void 0===e?void 0:e.state)==="inactive"){i.z.capture("speech_to_text_media_recorder_stop_called_in_invalid_state",{state:null===(r=this.mediaRecorder)||void 0===r?void 0:r.state,timeStamp:new Date().toISOString(),reason:"Stop attempted in invalid state"});return}null===(t=this.mediaRecorder)||void 0===t||t.stop(),this.releaseWakeLock();let l=null===(a=this.mediaRecorder)||void 0===a?void 0:null===(n=a.stream)||void 0===n?void 0:n.getTracks().reduce((e,t)=>{let n=t.getSettings();if(n){var a;return e+(null!==(a=n.frameRate)&&void 0!==a?a:0)}return e},0);i.z.capture("speech_to_text_media_recorder_stop",{state:null===(s=this.mediaRecorder)||void 0===s?void 0:s.state,finalBlobSize:l}),this.destroy()}pause(){var e;(null===(e=this.mediaRecorder)||void 0===e?void 0:e.state)==="recording"&&(this.mediaRecorder.pause(),this.releaseWakeLock(),i.z.capture("speech_to_text_media_recorder_pause"))}resume(){var e;(null===(e=this.mediaRecorder)||void 0===e?void 0:e.state)==="paused"&&(this.mediaRecorder.resume(),this.requestWakeLock(),i.z.capture("speech_to_text_media_recorder_resume"))}toggle(e){var t,n,a,s,r,l;try{e&&(null===(t=this.mediaRecorder)||void 0===t?void 0:t.state)!=="recording"?null===(s=this.mediaRecorder)||void 0===s||s.start(250):e||(null===(n=this.mediaRecorder)||void 0===n?void 0:n.state)==="inactive"||null===(r=this.mediaRecorder)||void 0===r||r.stop(),i.z.capture("speech_to_text_media_recorder_toggle",{on:e,currentState:null===(a=this.mediaRecorder)||void 0===a?void 0:a.state,timeStamp:new Date().toISOString()})}catch(n){let t=(0,o.P5)(n);i.z.capture("speech_to_text_media_recorder_toggle_error",{on:e,serializedError:t,currentState:null===(l=this.mediaRecorder)||void 0===l?void 0:l.state})}}destroy(){var e,t;null===(e=this.mediaRecorder)||void 0===e||e.removeEventListener("dataavailable",this.handleData),null===(t=this.mediaRecorder)||void 0===t||t.removeEventListener("error",e=>this.handleError(e)),this.mediaRecorder=null,this.counter=0,this.releaseWakeLock()}constructor(...e){super(...e),(0,a._)(this,"mediaRecorder",null),(0,a._)(this,"counter",0),(0,a._)(this,"wakeLock",null),(0,a._)(this,"handleData",e=>{e.data.size&&(this.emit("data",{id:this.counter,blob:e.data}),this.counter++)}),(0,a._)(this,"handleError",e=>{var t;l.Cp(e.error),i.z.capture("speech_to_text_media_recorder_error",{error:e.error,mediaRecorderState:null===(t=this.mediaRecorder)||void 0===t?void 0:t.state,userAgent:navigator.userAgent}),this.emit("error","Recording error",e)}),(0,a._)(this,"isWakeLockSupported",()=>"undefined"!=typeof navigator&&"wakeLock"in navigator),(0,a._)(this,"requestWakeLock",async()=>{if(!this.isWakeLockSupported()){i.z.capture("speech_to_text_wake_lock_not_supported");return}try{this.wakeLock=await navigator.wakeLock.request("screen"),this.wakeLock.addEventListener("release",()=>{i.z.capture("speech_to_text_wake_lock_released")}),i.z.capture("speech_to_text_wake_lock_active")}catch(e){if(this.isWakeLockNotAllowedError(e)){i.z.capture("speech_to_text_wake_lock_not_allowed");return}l.Cp(e),i.z.capture("speech_to_text_wake_lock_error",{error:e})}}),(0,a._)(this,"isWakeLockNotAllowedError",e=>e instanceof DOMException&&"NotAllowedError"===e.name),(0,a._)(this,"releaseWakeLock",async()=>{null!==this.wakeLock&&(this.wakeLock.release(),this.wakeLock=null,i.z.capture("speech_to_text_wake_lock_released"))})}}var u=n(79188),p=n(76990),m=n(60870),h=n(52105),g=n(5862),v=n(52710),f=n(7094);let x=(0,g._)({post:{body:f.z.object({model:f.z.nativeEnum(v.j)}),data:f.z.object({key:f.z.string(),expiry:f.z.string()})},put:{query:f.z.object({id:f.z.string(),part:f.z.string().optional(),model:f.z.nativeEnum(v.j),end:f.z.literal("true").or(f.z.literal("false"))}),body:f.z.unknown(),data:f.z.object({transcript:f.z.string()})}}),y=(0,h.In)("POST","/api/agent/speechToText",x.post.data),_=(0,h.In)("PUT","/api/agent/speechToText",x.put.data);var b=n(91777),k=n(16085),w=n.n(k),C=function(e){return e.Open="open",e.Close="close",e.StateChange="stateChange",e.Transcript="transcript",e.Reconnect="reconnect",e.Error="error",e}({});class S extends s.b{setState(e){if(e===this.state)return;let t=this.state;this.state=e,this.emit("stateChange",e,t),i.z.capture("speech_to_text_socket_state_change",{oldState:t,newState:e,timeStamp:new Date().toISOString(),reconnectCount:this.reconnectCount,pendingDataCount:this.pending.length})}async getApiKey(e){try{let t=await (0,h.oA)(y({body:{model:e.model}},{retryCount:3}));return i.z.capture("speech_to_text_socket_api_key",{event:{key_expiry:t.expiry},requestStatus:"success",timeStamp:new Date().toISOString()}),t.key}catch(t){let e=t instanceof Error?t.message:"Could not get API key";return i.z.capture("speech_to_text_socket_api_key_failure",{error:e,timeStamp:new Date().toISOString()}),l.Cp(t),this.emit("error",e),null}}async start(e){return this.options=e,this.reconnectCount=0,this.open()}async open(){var e;let t;if(!this.options)throw Error("Options are required to open the socket");if("opening"===this.state||"open"===this.state){i.z.capture("speech_to_text_socket_open_called_in_invalid_state",{state:this.state,timeStamp:new Date().toISOString(),options:JSON.stringify(this.options)});return}"reconnecting"!==this.state&&this.setState("opening");let n=await this.getApiKey(this.options);if(!n)throw Error("Could not get api key");let a=(0,u.UU)(n),{language:s,model:r}=this.options;null===(e=this.socket)||void 0===e||e.removeAllListeners(),this.socket=a.listen.live({model:r,language:null!=s?s:"en-US",smart_format:!0}),this.socket.on(p.Y.Open,this.handleOpen),this.socket.on(p.Y.Close,this.handleClose),this.socket.on(p.Y.Transcript,this.handleTranscript),this.socket.on(p.Y.Error,this.handleError),this.socket.on(p.Y.Metadata,this.handleMetadata),this.bufferEmitted=!1;let l="reconnecting"===this.state;return l&&this.emit("reconnect",!1),Promise.race([new Promise((e,n)=>{var a,s;let r=async()=>{var n;null===(n=this.socket)||void 0===n||n.off(p.Y.Error,o),clearTimeout(t),this.emit("reconnect",l),this.startBufferingImmediately(),await this.recoverPending(),this.flushBuffer(),this.startKeepAlive(),e()},o=e=>{clearTimeout(t),i.z.capture("speech_to_text_socket_connect_error",{event:e}),this.handleOpenSocketError(),n("Connection error")};null===(a=this.socket)||void 0===a||a.once(p.Y.Error,o),null===(s=this.socket)||void 0===s||s.once(p.Y.Open,r)}),new Promise((e,n)=>{t=setTimeout(()=>{i.z.capture("speech_to_text_socket_connect_timeout"),this.handleOpenSocketError(),n("Connection timeout")},8e3)})])}constructor(...e){super(...e),(0,a._)(this,"socket",null),(0,a._)(this,"pending",[]),(0,a._)(this,"received",[]),(0,a._)(this,"options",null),(0,a._)(this,"state","closed"),(0,a._)(this,"reconnectTimeoutId",void 0),(0,a._)(this,"reconnectCount",0),(0,a._)(this,"hasCapturedTranscriptReceived",!1),(0,a._)(this,"keepAliveInterval",null),(0,a._)(this,"buffering",!1),(0,a._)(this,"transcriptBuffer",[]),(0,a._)(this,"bufferEmitted",!1),(0,a._)(this,"lastDataSentTime",0),(0,a._)(this,"KEEPALIVE_INTERVAL_MS",5e3),(0,a._)(this,"handleOpenSocketError",()=>{var e;null===(e=this.socket)||void 0===e||e.removeAllListeners(),"reconnecting"===this.state?(this.setState("disconnected"),this.reconnect()):this.setState("closed"),this.transcriptBuffer=[],this.buffering=!1}),(0,a._)(this,"startBufferingImmediately",()=>{this.buffering=!0}),(0,a._)(this,"flushBuffer",()=>{!this.bufferEmitted&&this.transcriptBuffer.length>0&&(this.transcriptBuffer.forEach(e=>this.handleTranscript(e)),this.buffering=!0),this.transcriptBuffer=[]}),(0,a._)(this,"handleTranscript",e=>{var t,n,a,s;if(!e.is_final)return;this.pending.length=0,this.hasCapturedTranscriptReceived||(i.z.capture("speech_to_text_socket_first_transcript_received",{requestId:e.metadata.request_id,transcriptLength:null===(s=e.channel)||void 0===s?void 0:null===(a=s.alternatives.at(0))||void 0===a?void 0:a.transcript.length,timeStamp:new Date().toISOString()}),this.hasCapturedTranscriptReceived=!0);let r=null===(n=e.channel)||void 0===n?void 0:null===(t=n.alternatives.at(0))||void 0===t?void 0:t.transcript;(null==r?void 0:r.trim())&&this.emit("transcript",r)}),(0,a._)(this,"handleOpen",async()=>{if(!this.socket)throw Error("Socket destroyed");this.setState("open"),this.socket.keepAlive()}),(0,a._)(this,"reconnect",async()=>{if("reconnecting"===this.state||"open"===this.state||"opening"===this.state){i.z.capture("speech_to_text_socket_reconnect_called_in_invalid_state",{state:this.state});return}this.reconnectCount++,i.z.capture("speech_to_text_socket_reconnecting",{reconnectCount:this.reconnectCount,stateBeforeReconnect:this.state,timeStamp:new Date().toISOString()}),this.destroy(),this.setState("reconnecting"),this.emit("error","Reconnecting...");let e=200+200*Math.min(32,Math.pow(2,this.reconnectCount));this.reconnectTimeoutId=setTimeout(()=>this.open(),e)}),(0,a._)(this,"handleClose",e=>{if("closing"!==this.state&&"closed"!==this.state){i.z.capture("speech_to_text_socket_closed_unexpectedly",{code:null==e?void 0:e.code,reason:null==e?void 0:e.reason,wasClean:null==e?void 0:e.wasClean,timeStamp:new Date().toISOString()}),this.setState("disconnected"),this.reconnect();return}i.z.capture("speech_to_text_socket_closed_normally"),this.destroy()}),(0,a._)(this,"handleError",e=>{var t;l.Cp(e),this.emit("error",null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"Connection error",e)}),(0,a._)(this,"handleMetadata",e=>{i.z.capture("speech_to_text_socket_metadata",{event:e})}),(0,a._)(this,"send",e=>{var t;if(this.received.push(e),this.pending.push(e),this.lastDataSentTime=Date.now(),(null===(t=this.socket)||void 0===t?void 0:t.getReadyState())!==m.y.OPEN){"open"===this.state&&i.z.capture("speech_to_text_socket_send_called_in_invalid_state",{state:this.state,readyState:this.socket?m.y[this.socket.getReadyState()]:"null",timeStamp:new Date().toISOString(),pendingDataCount:this.pending.length});return}this.socket.send(e.blob)}),(0,a._)(this,"finish",async()=>{let e;if("closing"===this.state||"closed"===this.state){i.z.capture("speech_to_text_socket_close_called_in_invalid_state",{state:this.state});return}if(this.setState("closing"),!this.socket||this.socket.getReadyState()!==m.y.OPEN){i.z.capture("speech_to_text_socket_close_called_in_invalid_ready_state",{readyState:this.socket?m.y[this.socket.getReadyState()]:"null"}),this.destroy(),this.setState("closed");return}let t=new Promise(t=>{var n,a;null===(n=this.socket)||void 0===n||n.once(p.Y.Close,()=>{clearTimeout(e),i.z.capture("speech_to_text_socket_closed_successfully"),t()}),i.z.capture("speech_to_text_socket_finishing"),null===(a=this.socket)||void 0===a||a.finish()}),n=new Promise((t,n)=>{e=setTimeout(()=>{i.z.capture("speech_to_text_socket_close_timeout"),this.destroy(),this.setState("closed"),n("Timed out closing connection")},3e4)});try{await Promise.race([t,n])}catch(e){throw i.z.capture("speech_to_text_socket_close_error",{error:e}),e}}),(0,a._)(this,"destroy",()=>{var e;i.z.capture("speech_to_text_socket_destroy"),clearTimeout(this.reconnectTimeoutId),null===(e=this.socket)||void 0===e||e.removeAllListeners(),this.hasCapturedTranscriptReceived=!1,this.stopKeepAlive()}),(0,a._)(this,"recoverPending",async()=>{try{var e,t,n,a,s;if(this.pending.length<8)return;i.z.capture("speech_to_text_socket_send_pending",{count:this.pending.length,blobIds:"".concat(null===(e=this.pending.at(0))||void 0===e?void 0:e.id," to ").concat(null===(t=this.pending.at(-1))||void 0===t?void 0:t.id)});let l=null===(n=this.pending.at(0))||void 0===n?void 0:n.id,o=this.received.findIndex(e=>e.id===l);o>4&&(o-=4);let d=o/this.received.length,c=new Blob(this.received.map(e=>e.blob),{type:r()}),u=await c.arrayBuffer(),p=new AudioContext,m=await p.decodeAudioData(u),g=Math.floor(d*m.length),f=m.getChannelData(0).slice(g),x=m.sampleRate,y=p.createBuffer(1,f.length,x);y.copyToChannel(f,0);let k=w()(y),C=new Blob([new DataView(k)],{type:"audio/wav"}),S=new FormData;S.append("file",C,"1");let j=await (0,h.oA)(_({query:{id:(0,b.gZ)(),part:"1",model:null!==(s=null===(a=this.options)||void 0===a?void 0:a.model)&&void 0!==s?s:v.j.Nova2,end:"true"},body:S}));this.emit("transcript",j.transcript)}catch(e){i.z.capture("speech_to_text_socket_recover_pending_error",{error:e})}}),(0,a._)(this,"startKeepAlive",()=>{null===this.keepAliveInterval&&(this.keepAliveInterval=setInterval(()=>{var e;let t=Date.now();(null===(e=this.socket)||void 0===e?void 0:e.getReadyState())===m.y.OPEN&&t-this.lastDataSentTime>=this.KEEPALIVE_INTERVAL_MS&&(this.socket.keepAlive(),this.lastDataSentTime=t)},this.KEEPALIVE_INTERVAL_MS))}),(0,a._)(this,"stopKeepAlive",()=>{null!==this.keepAliveInterval&&(clearInterval(this.keepAliveInterval),this.keepAliveInterval=null)})}}let j=()=>{try{return new AudioContext}catch(e){return null}},I=null;async function T(e){I||(I=j());try{if(!I)throw Error("AudioContext not supported");let t=await e.arrayBuffer(),n=await I.decodeAudioData(t),a=n.getChannelData(0),i=Math.max(Math.floor(a.length/1e5),1),s=function(e,t){t<1&&(t=1);let n=0,a=0;for(let s=0;s<e.length;s+=t){var i;let t=null!==(i=e.at(s))&&void 0!==i?i:0;n+=t*t,a++}return Math.sqrt(n/a)}(a,i);return{isValidAudioFile:!0,isOnlyAmbientNoise:s<.015,isCompletelySilent:s<1e-5,durationSeconds:n.duration}}catch(e){return l.Cp(e),i.z.capture("speech_to_text_audio_decode_error",{message:e instanceof Error?e.message:String(e)}),{isValidAudioFile:!I,isOnlyAmbientNoise:!1,isCompletelySilent:!1,durationSeconds:0}}}var E=function(e){return e.Processing="processing",e.Transcript="transcript",e.Error="error",e}({});class N extends s.b{start(e){this.destroy(),this.id=(0,b.gZ)(),this.options=e}async uploadPart(e){let{part:t,end:n,retry:a}=e;if(!this.options)throw Error("UploadManager not started");i.z.capture("speech_to_text_upload_part_start",{partNumber:t.num,end:n,uploadId:this.id,partSize:t.blob.size});let s=new FormData;s.append("file",t.blob,t.num.toString());try{let e=await (0,h.oA)(_({query:{id:this.id,part:t.num.toString(),model:this.options.model,end:n?"true":"false"},body:s},{retryCount:a?3:0}));i.z.capture("speech_to_text_upload_part_complete",{partNumber:t.num,end:n,uploadId:this.id});let r=this.parts.find(e=>e.num===t.num);r&&(r.done=!0),n&&this.emit("transcript",e.transcript)}catch(a){let e=a.message||"An error occurred while uploading the audio";if(l.Cp(a),i.z.capture("speech_to_text_upload_part_error",{error:e,partNumber:t.num,end:n,totalSize:this.parts.reduce((e,t)=>e+t.blob.size,0),numParts:this.parts.length,timeStamp:new Date().toISOString()}),!n)return;this.emit("error",e,a)}}addCurrentChunksToPartBuffer(){var e,t;let n=this.parts.length+1;i.z.capture("speech_to_text_upload_add_part",{partNumber:n,blobIds:"".concat(null===(e=this.chunks.at(0))||void 0===e?void 0:e.id," to ").concat(null===(t=this.chunks.at(-1))||void 0===t?void 0:t.id),timeStamp:new Date().toISOString(),currentBufferSize:this.chunks.reduce((e,t)=>e+t.blob.size,0)});let a=new Blob(this.chunks.map(e=>e.blob),{type:r()});this.chunks.length=0;let s={blob:a,num:n,done:!1};return this.parts.push(s),s}destroy(){i.z.capture("speech_to_text_upload_destroy",{uploadId:this.id,timeStamp:new Date().toISOString()}),this.uploads.length=0,this.parts.length=0,this.chunks.length=0}constructor(...e){super(...e),(0,a._)(this,"id",""),(0,a._)(this,"chunks",[]),(0,a._)(this,"parts",[]),(0,a._)(this,"uploads",[]),(0,a._)(this,"options",null),(0,a._)(this,"add",e=>{if(e.blob.size&&(this.chunks.push(e),this.chunks.reduce((e,t)=>e+t.blob.size,0)>5242880)){let e=this.addCurrentChunksToPartBuffer(),t=this.uploadPart({part:e,end:!1});this.uploads.push(t)}}),(0,a._)(this,"finish",async()=>{this.emit("processing"),await Promise.allSettled(this.uploads);let e=this.addCurrentChunksToPartBuffer(),t=new Blob(this.parts.map(e=>e.blob)),{isOnlyAmbientNoise:n,isCompletelySilent:a,durationSeconds:i}=await T(t);try{if(n)throw i>2&&this.emit("error",a?"No audio detected, please check your microphone.":"Inaudible audio detected."),new A;let t=this.parts.filter(t=>t.num!==e.num&&!t.done);await Promise.all(t.map(e=>this.uploadPart({part:e,end:!1,retry:!0}))),await this.uploadPart({part:e,end:!0,retry:!0})}catch(t){if(t instanceof A)return;let e=t instanceof Error?t.message:"An error occurred while uploading the audio";throw l.Cp(t),Error(e)}finally{this.destroy()}})}}class A extends Error{constructor(){super("Silent audio detected."),(0,a._)(this,"name","SilentAudioError")}}var P=function(e){return e.Transcript="transcript",e.StateChange="stateChange",e.Error="error",e}({}),F=function(e){return e.Starting="starting",e.Started="started",e.Paused="paused",e.Stopping="stopping",e.Stopped="stopped",e.Reconnecting="reconnecting",e}({});let R=new Set(["AbortError","InvalidStateError","NotAllowedError","NotFoundError","NotReadableError","InvalidStateError","InvalidStateError"]);class z extends s.b{setState(e){if(e===this.state)return;let t=this.state;this.state=e,this.emit("stateChange",e,t),i.z.capture("speech_to_text_transcriber_state_change",{oldState:t,newState:e,timeStamp:new Date().toISOString()})}get startingOrStarted(){return"starting"===this.state||"started"===this.state}get stoppingOrStopped(){return"stopping"===this.state||"stopped"===this.state}async start(e){try{if("stopping"===this.state||this.startingOrStarted){i.z.capture("speech_to_text_transcriber_start_called_in_invalid_state",{state:this.state});return}if(this.setState("starting"),this.micStream=await navigator.mediaDevices.getUserMedia({audio:!0}),this.stoppingOrStopped)return;e.streaming?(this.socketClient=new S,this.socketClient.on(C.Transcript,this.handleTranscript),this.socketClient.on(C.Error,this.handleError),this.socketClient.on(C.Reconnect,this.handleReconnect),this.recorder.on(d.Data,this.socketClient.send),await this.socketClient.start(e)):(this.uploadManager=new N,this.uploadManager.on(E.Transcript,this.handleTranscript),this.uploadManager.on(E.Error,this.handleError),this.recorder.on(d.Data,this.uploadManager.add),this.uploadManager.start(e)),this.recorder.on(d.Error,e=>console.error(e)),this.recorder.start(this.micStream),this.setState("started"),this.startRecordingLimitTimeout()}catch(t){let e=R.has(null==t?void 0:t.name)?"Unable to access your microphone. Please ensure it is connected and try again.":t instanceof Error?t.message:"Failed to start recording. Please try again.";i.z.capture("speech_to_text_transcriber_mic_access_error",{errorMessage:e,errorName:null==t?void 0:t.name,userAgent:navigator.userAgent,timeStamp:new Date().toISOString()}),this.emit("error",e,t),this.stopRecording(),this.destroy()}}async pause(){"started"===this.state&&(this.recorder.pause(),this.setState("paused"),i.z.capture("speech_to_text_transcriber_pause",{currentState:this.state,timeStamp:new Date().toISOString()}))}async resume(){"paused"===this.state&&(this.recorder.resume(),this.setState("started"),i.z.capture("speech_to_text_transcriber_resume",{currentState:this.state,timeStamp:new Date().toISOString()}))}async stop(){if("starting"===this.state||this.stoppingOrStopped){i.z.capture("speech_to_text_transcriber_stop_called_in_invalid_state",{state:this.state});return}this.setState("stopping"),this.stopRecording(),await this.finish()}startRecordingLimitTimeout(){window.clearTimeout(this.recordingLimitTimeoutId),this.recordingLimitTimeoutId=window.setTimeout(()=>{i.z.capture("speech_to_text_recording_time_limit_reached"),this.stop()},108e5)}stopRecording(){var e;window.clearTimeout(this.recordingLimitTimeoutId),null===(e=this.micStream)||void 0===e||e.getTracks().forEach(e=>e.stop()),this.recorder.stop()}destroy(){var e,t;this.recorder.destroy(),this.recorder.removeAllListeners(),null===(e=this.socketClient)||void 0===e||e.removeAllListeners(),this.socketClient=null,null===(t=this.uploadManager)||void 0===t||t.removeAllListeners(),this.uploadManager=null,this.setState("stopped")}async finish(){i.z.capture("speech_to_text_transcriber_finish");try{var e,t;await (null===(e=this.socketClient)||void 0===e?void 0:e.finish()),await (null===(t=this.uploadManager)||void 0===t?void 0:t.finish())}catch(t){let e=t instanceof Error?t.message:"Failed to finish recording";this.emit("error",e,t)}this.destroy()}constructor(...e){super(...e),(0,a._)(this,"recorder",new c),(0,a._)(this,"socketClient",null),(0,a._)(this,"uploadManager",null),(0,a._)(this,"micStream",null),(0,a._)(this,"state","stopped"),(0,a._)(this,"recordingLimitTimeoutId",0),(0,a._)(this,"handleTranscript",e=>{this.emit("transcript",e)}),(0,a._)(this,"handleError",(e,t)=>{this.emit("error",e,t),i.z.capture("speech_to_text_transcriber_error",{errorMessage:e,errorType:t instanceof Error?"Exception":"Other",currentState:this.state,timeStamp:new Date().toISOString()})}),(0,a._)(this,"handleReconnect",e=>{this.recorder.toggle(e),this.setState(e?"started":"reconnecting")})}}let M=new z},48571:(e,t,n)=>{"use strict";n.d(t,{h:()=>_});var a=n(50612),i=n(38001),s=n(10293),r=n(90508),l=n(39274),o=n(94344),d=n(25919),c=n(94488),u=n(76532),p=n(78629),m=n(11902),h=n.n(m);let g=(0,o.memo)(function(e){let{children:t}=e;return(0,a.jsx)("div",{className:h().enter,children:t})}),v=(0,o.memo)(function(e){let{avatar:t,isInput:n,message:i,sentimentEl:s,className:r,proseClassName:l,...o}=e,d=(0,a.jsxs)(u.V,{className:l,children:[s,(0,a.jsx)(p.cq,{isInput:n,children:i})]}),m=n?(0,a.jsx)(g,{children:d}):d;return(0,a.jsx)(c.P,{avatar:t,className:r,...o,children:m})});var f=n(96556),x=n.n(f);function y(e){let{children:t}=e;return(0,a.jsx)("div",{className:x().enter,children:t})}let _=(0,o.memo)(function(e){let{message:t,sentimentEl:n,className:c,showAvatar:u=!1,animateTokens:p=!0,proseClassName:m,...h}=e,g=function(){var e,t;let{data:n}=(0,i.LM)(),{data:a}=(0,s.f)(null==n?void 0:n.agentDefinitionId);return{icon:(0,r.hq)(null==a?void 0:null===(e=a.icon)||void 0===e?void 0:e.name),color:null==a?void 0:null===(t=a.icon)||void 0===t?void 0:t.color}}(),f=(0,o.useMemo)(()=>u&&""!==t.trim()?(0,a.jsx)(y,{children:(0,a.jsx)(l.l,{icon:g.icon,color:g.color})}):null,[g.color,g.icon,t,u]);return(0,a.jsx)(v,{className:c,proseClassName:(0,d.QP)(m,u?"-mt-4":""),avatar:f,isInput:p,message:t,sentimentEl:n,...h})})},46772:(e,t,n)=>{"use strict";n.d(t,{u:()=>c,b:()=>u});var a=n(50612);let i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SubscriptionContext_Identity",selections:[{alias:null,args:null,concreteType:"SubscriptionInfo",kind:"LinkedField",name:"billingInfo",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"billingVersion",storageKey:null},{alias:null,args:null,concreteType:"SubscriptionFeatures",kind:"LinkedField",name:"features",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"arePremiumFeaturesEnabled",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"hasKnowledgeBaseIncreasedLimits",storageKey:null}],storageKey:null}],storageKey:null},{args:null,kind:"FragmentSpread",name:"PlansModal_Identity"}],type:"Identity",abstractKey:null};i.hash="ea4c1277eb1862c601cc7a9bc1c01484";var s=n(12454),r=n(19221),l=n(94344),o=n(79124);n(97244);let d=l.createContext({arePremiumFeaturesEnabled:!0,hasKnowledgeBaseIncreasedLimits:!0});function c(e){let{toggle:t,hide:n}=(0,r.j)(),c=(0,o.useFragment)(i,e.identityFragmentRef),u=l.useMemo(()=>{var e,n,a,i,s,r,l;return{arePremiumFeaturesEnabled:null===(r=null==c?void 0:null===(n=c.billingInfo)||void 0===n?void 0:null===(e=n.features)||void 0===e?void 0:e.arePremiumFeaturesEnabled)||void 0===r||r,hasKnowledgeBaseIncreasedLimits:null===(l=null==c?void 0:null===(i=c.billingInfo)||void 0===i?void 0:null===(a=i.features)||void 0===a?void 0:a.hasKnowledgeBaseIncreasedLimits)||void 0===l||l,billingV3:(null==c?void 0:null===(s=c.billingInfo)||void 0===s?void 0:s.billingVersion)==="V3",upgrade:t}},[c,t]);return(0,a.jsxs)(d.Provider,{value:u,children:[e.children,(0,a.jsx)(s.E,{identityFragmentRef:c,hide:n,toggle:t})]})}function u(){return l.useContext(d)}},98906:(e,t,n)=>{"use strict";function a(e){document.cookie="".concat("redirectToChat","=").concat(e,"; domain=").concat("lindy.ai","; path=").concat("/","; max-age=").concat(2592e3)}n.d(t,{r:()=>a})},7230:(e,t,n)=>{"use strict";n.d(t,{O:()=>r});var a=n(10293),i=n(19900),s=n(18983);function r(){var e,t,n,r,l,o,d,c,u,p,m,h;let{data:g}=(0,a.f)();return{sensitive:null!==(t=null==(e=null==g?void 0:g.flags)?void 0:e.sensitive)&&void 0!==t&&t,clinician:null!==(n=null==e?void 0:e.clinician)&&void 0!==n&&n,onRails:null!==(r=null==e?void 0:e.onRails)&&void 0!==r&&r,guidesUrl:null!==(l=null==e?void 0:e.guidesUrl)&&void 0!==l?l:"https://help.lindy.ai/en/articles/8897103-writing-effective-guidelines",taskLabel:null!==(o=null==e?void 0:e.taskLabel)&&void 0!==o?o:"Task",defaultSpeechToTextModel:null!==(d=null==e?void 0:e.defaultSpeechToTextModel)&&void 0!==d?d:s.a.SingleLanguage,speechToTextModalMode:null!==(c=null==e?void 0:e.speechToTextModalMode)&&void 0!==c&&c,executionCreditLimit:null!==(u=null==e?void 0:e.executionCreditLimit)&&void 0!==u?u:i.Fi,kbMaxResultsPerSearch:null!==(p=null==e?void 0:e.kbMaxResultsPerSearch)&&void 0!==p?p:i.tV,kbHybridSearchSemanticWeight:null!==(m=null==e?void 0:e.kbHybridSearchSemanticWeight)&&void 0!==m?m:i.VE,kbHybridSearchKeywordWeight:null!==(h=null==e?void 0:e.kbHybridSearchKeywordWeight)&&void 0!==h?h:i.u8}}},47376:(e,t,n)=>{"use strict";n.d(t,{W:()=>h});var a=n(52105),i=n(5862),s=n(38928),r=n(7094);let l=(0,i._)({get:{params:r.z.object({id:s.k.objectIdString()}),data:r.z.array(r.z.string())}});var o=n(98354),d=n(94344),c=n(94559),u=n(79879);let p=(0,a.In)("GET","/api/conversations/agentDefinition/:id/inputHistory",l.get.data);var m=n(10293);function h(){var e,t,n;let a=(0,m.f)();return function(e){let t=(0,d.useMemo)(()=>["conversations/agentDefinition/[id]/inputHistory","get",e.params.id],[e.params.id]),n=(0,c.lB)(()=>null==e?void 0:e.options,[null==e?void 0:e.options]),a=(0,o.I)({queryKey:t,queryFn:async()=>{let{data:t,error:n}=await p(e);if(n)throw n;return t},...null==e?void 0:e.options}),i=(0,c.lB)(()=>a,[a]);return(0,u.R)(t,i,n)}({params:{id:null!==(n=null===(e=a.data)||void 0===e?void 0:e._id)&&void 0!==n?n:""},options:{enabled:!!(null===(t=a.data)||void 0===t?void 0:t._id),staleTime:3e5}})}},51068:(e,t,n)=>{"use strict";n.d(t,{r:()=>p});var a=n(52105),i=n(50561),s=n(98354),r=n(94344),l=n(94559),o=n(79879);let d=(0,a.In)("GET","/api/identity/:id/settings",i.w.get.data);var c=n(78233),u=n(77576);function p(){var e,t,n,a;let i=(0,u.U)(),p=(0,c.v)(),m=function(e){let t=(0,r.useMemo)(()=>["identity/[id]/settings","get",e.params.id],[e.params.id]),n=(0,l.lB)(()=>null==e?void 0:e.options,[null==e?void 0:e.options]),a=(0,s.I)({queryKey:t,queryFn:async()=>{let{data:t,error:n}=await d(e);if(n)throw n;return t},...null==e?void 0:e.options}),i=(0,l.lB)(()=>a,[a]);return(0,o.R)(t,i,n)}({params:{id:null!==(a=null===(e=i.data)||void 0===e?void 0:e.id)&&void 0!==a?a:""},options:{enabled:!!p&&!!(null===(t=i.data)||void 0===t?void 0:t.id)}}),h=!!m.data,g=null===(n=m.data)||void 0===n?void 0:n.openMainWindowHotkey;(0,r.useEffect)(()=>{p&&h&&p.setOpenMainWindowHotkey(null!=g?g:"Control+Shift+Space")},[p,h,g])}},82813:(e,t,n)=>{"use strict";n.d(t,{p:()=>i});var a=n(94344);function i(e){(0,a.useEffect)(()=>{function t(t){e.current&&function(e){let t=e.target;return!(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement||t instanceof HTMLElement&&"true"===t.contentEditable)&&(null==t||t===document.body||t!==document.activeElement)&&/^[\d A-Za-z]$/.test(e.key)&&!e.ctrlKey&&!e.metaKey&&!e.altKey}(t)&&(t.preventDefault(),e.current.focus(),e.current.value+=t.key)}return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[e])}},14584:(e,t,n)=>{"use strict";n.d(t,{U:()=>y});var a=n(98722),i=n(88620),s=n(52105),r=n(5862),l=n(34698),o=n(38928),d=n(7094);let c=(0,r._)({post:{body:d.z.object({input:d.z.string().default(""),timeZone:d.z.string().optional(),realtimeSessionId:d.z.string().nullish(),attachmentIds:o.k.objectIdString().array().optional(),isPrivate:d.z.boolean().optional(),title:d.z.string().optional(),agentDefinitionId:o.k.objectIdString(),parentId:o.k.objectIdString().nullable(),blocks:d.z.array(l.jn).optional(),params:d.z.record(d.z.any()).nullish(),onboarding:d.z.boolean().optional().default(!1),ts:d.z.coerce.date().optional()}),data:d.z.object({conversationId:o.k.objectIdString(),messageId:o.k.objectIdString().nullish()})}}),u=(0,s.In)("POST","/api/conversations",c.post.data);var p=n(87021),m=n(90819),h=n(71752),g=n(2932),v=n(89073),f=n(94344),x=n(79124);function y(e){let t=(0,x.useRelayEnvironment)(),n=(0,v.jE)(),[r,l]=(0,p.Q)(),o=(0,m.T)(),d=(0,i.ec)({query:{},params:{id:null!=o?o:""}}),c=(0,f.useCallback)(async i=>{var r;let c,{task:p,attachments:m,realtimeSessionId:v}=i,f=new Date,x=null!==(r=Intl.DateTimeFormat().resolvedOptions().timeZone)&&void 0!==r?r:"UTC",y=m.map(e=>e.attachmentId);if(e)c={input:p,attachmentIds:y,conversationId:e,ts:f,realtimeSessionId:v};else{let e=c={agentDefinitionId:o,input:p,timeZone:x,attachmentIds:y,params:{},parentId:null,ts:f,realtimeSessionId:v};o&&(e.agentDefinitionId=o),e.parentId=null}o&&!e&&n.setQueryData(d,e=>{var t;let n={_id:"",blocks:[],status:g.Y.Running,updatedAt:new Date,statusUpdatedAt:new Date,title:"",isSeen:!1,onboarding:!1,__isOptimistic:!0};return e?{...e,pages:null===(t=e.pages)||void 0===t?void 0:t.map((e,t)=>{var a;return t>0?e:{...e,data:[n,...null!==(a=e.data)&&void 0!==a?a:[]]}})}:e});let _=await (0,s.oA)(e?(0,a.A)({body:c}):u({body:c}));return(null==_?void 0:_.conversationId)&&(await l(_.conversationId),o&&(0,h.L)({relayEnvironment:t,conversationId:_.conversationId,agentDefinitionId:o})),_},[o,e,n,d,l,t]);return(0,f.useMemo)(()=>({onSubmitTask:c}),[c])}},60003:(e,t,n)=>{"use strict";n.d(t,{t:()=>h});var a=n(50612),i=n(9484),s=n(83664),r=n(31634),l=n(10293),o=n(31024),d=n(39274),c=n(90508),u=n(52843),p=n(81778),m=n(94344);let h=(0,m.memo)(function(){var e,t,n,h;let g=(0,p.useRouter)(),{data:v}=(0,l.f)(),{data:f}=(0,i.T2)({params:{id:null!==(n=null==v?void 0:v.templateId)&&void 0!==n?n:""},options:{enabled:!!(null==v?void 0:v.templateId)}}),{data:x}=(0,s.QT)({params:{id:null!==(h=null==f?void 0:f.ownerId)&&void 0!==h?h:""},options:{enabled:!!(null==f?void 0:f.ownerId)}}),y=(0,m.useCallback)(()=>{(null==x?void 0:x.id)&&g.push("/marketplace/author/".concat(x.id))},[g,x]),_=(0,m.useCallback)(()=>{(null==x?void 0:x.id)&&(null==f?void 0:f._id)&&g.push("/marketplace/author/".concat(x.id,"?templateId=").concat(f._id))},[g,null==x?void 0:x.id,null==f?void 0:f._id]);if(!f)return null;let b=(0,c.hq)(null===(e=f.icon)||void 0===e?void 0:e.name),k=null==f?void 0:null===(t=f.icon)||void 0===t?void 0:t.color;return(0,a.jsxs)(o.V,{center:!0,className:"w-full max-w-[350px] select-none",children:[(0,a.jsx)(d.l,{icon:b,color:k}),(0,a.jsx)("button",{className:"cursor-pointer text-sm font-semibold text-slate-12 hover:underline",onClick:_,children:f.name}),f.subTitle&&!f.greetingMessage&&(0,a.jsx)("div",{className:"line-clamp-2 text-center text-xs text-slate-11",children:f.subTitle}),(0,a.jsxs)(r.f,{center:!0,children:[x&&(0,a.jsxs)(r.f,{center:!0,children:[(0,a.jsx)("button",{className:"cursor-pointer text-xs font-medium text-slate-11 hover:text-slate-12",onClick:y,children:x.name}),(0,a.jsx)("span",{className:"group p-1 text-xs text-slate-6",children:"â€¢"})]}),f.updatedAt&&(0,a.jsxs)("div",{className:"text-xs text-slate-11",children:["Updated ",(0,u.A)(new Date(f.updatedAt))," ago"]})]})]})})},71752:(e,t,n)=>{"use strict";n.d(t,{L:()=>s});var a=n(20923),i=n(97244);function s(e){(0,i.commitLocalUpdate)(e.relayEnvironment,t=>{var n;let s=(0,a.F)("Conversation",e.conversationId),r=t.get(s),l=null!=r?r:t.create(s,"Conversation");for(let[n,a]of Object.entries({id:e.conversationId,nodeId:s,updatedAt:new Date().toISOString(),title:"New task",status:"Pending",hasNotification:!1})){if("blocks"===n){if(null!=l.getLinkedRecord("blocks"))continue;let e=t.create(s+":blocks","ConversationBlockConnection");l.setLinkedRecord(e,"blocks");continue}null==l.getValue(n)&&l.setValue(a,n)}let o=(0,a.F)("AgentDefinition",e.agentDefinitionId),d=t.get(o);if(!d)return;let c=i.ConnectionHandler.getConnection(d,"ThreadsListAgentDefinitionFragment_conversations");if(!c||(null!==(n=c.getLinkedRecords("edges"))&&void 0!==n?n:[]).find(t=>{let n=t.getLinkedRecord("node");return(null==n?void 0:n.getValue("id"))===e.conversationId}))return;let u=i.ConnectionHandler.createEdge(t,c,l,"Conversation");i.ConnectionHandler.insertEdgeBefore(c,u)})}},19900:(e,t,n)=>{"use strict";n.d(t,{Fi:()=>a,VE:()=>s,qt:()=>l,tV:()=>i,u8:()=>r});let a=500,i=4,s=.5,r=.5,l="6616f2edac8ad341b38269ba"},88898:e=>{e.exports={pulseAnimation:"RecordingAnimation_pulseAnimation__XLK_1",pulseHeight:"RecordingAnimation_pulseHeight__QR2pk",delay10:"RecordingAnimation_delay10__eVPVV",delay20:"RecordingAnimation_delay20__raM29",delay30:"RecordingAnimation_delay30__O3erE",delay40:"RecordingAnimation_delay40__KvXmO",delay50:"RecordingAnimation_delay50__sEAgy",delay60:"RecordingAnimation_delay60__gS0zP",delay70:"RecordingAnimation_delay70__tiW3e",delay80:"RecordingAnimation_delay80___p098",delay90:"RecordingAnimation_delay90__8UdyT"}},11827:e=>{e.exports={a:"speechAnimation_a__EyJC2",b:"speechAnimation_b__xTm4d",c:"speechAnimation_c__A4CUS",animate:"speechAnimation_animate__NbUr9","a-frames":"speechAnimation_a-frames___Ddr1","b-frames":"speechAnimation_b-frames__J7ZPR","c-frames":"speechAnimation_c-frames__abWyh"}},96556:e=>{e.exports={enter:"responseAvatarEnterAnimation_enter__dX1Ho"}},11902:e=>{e.exports={enter:"userResponseEnterAnimation_enter__D9otc"}}}]);